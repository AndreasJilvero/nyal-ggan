var mtr_form=mtr_form||function(){function f(){var i=new Date,t;for(i.setTime(i.getTime()+3e4),t=0;t<n.length;t++)mtr_form.SetCookie("utm_custom_"+n[t].name,n[t].value,i);try{mtr.log("","Form submit");mtr.pause()}catch(r){console.log(r)}}function e(n,t,i){r(n,"change",function(){i(n,t)})}function o(t,r){t.type!="password"&&e(t,r,function(t,r){u(n,i[r]);n.push({name:i[r],value:t.value})})}function s(t,i){e(t,i,function(t,i){u(n,i);n.push({name:i,value:t.value})})}function r(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent("on"+t,function(){return i.call(n,window.event)})}var n,t=[/(.*e-?mail.*)|(.*e-?post.*)/i,/(.*first[-|_]?name)|(f-?name)|(.*förnamn)$/i,/(.*last[-|_]?name)|(sur-?name)|(.*efternamn)|(enam[e|n])$/i,/^(^\*?\s?nam[e|n]:?\s?\*?$)|(^user-?name$)|(^(your|ditt)[_|-]?(name|namn)$)|(navn)$/i,/(.*organization*)|(organisation)|(org-?name)|(firm)|(company[-?name]?)|(.*företag.*)$/i,/(.*tel.*)|(.*tel.*n[umber]?r)|(.*mobil.*)|(.*phone.*)$/i],i=["email","firstname","lastname","name","organization","telephone"],h=function(){var a=window.custom_fieldnames||[],c,e,h,u,l,v,y,k,p,w,b,d,g,nt;for(n=[],c=document.getElementsByTagName("form"),e=0;e<c.length;e++)if(!c[e].getAttribute("data-mtr")){for(c[e].setAttribute("data-mtr",!0),h=c[e].getElementsByTagName("input"),u=0;u<h.length;u++){if(l=!1,h[u].type=="email"&&(s(h[u],"email"),l=!0),!l)for(v=0;v<a.length;v++)if(a[v][1]==h[u].name){s(h[u],a[v][0]);l=!0;break}if(!l)for(y=0;y<t.length;y++)if(h[u].name.match(t[y])){o(h[u],y);l=!0;break}}for(k=c[e].getElementsByTagName("label"),p=0;p<k.length;p++)for(w=0;w<t.length;w++)if(k[p].innerHTML.match(t[w])&&(b=document.getElementById(k[p].getAttribute("for")),b)){for(d=!1,g=0;g<i.length;g++)if(i[g]===b.name){d=!0;break}for(nt=0;nt<a.length;nt++)if(a[nt][1]===b.name){d=!0;break}d||o(b,w)}r(c[e],"submit",f)}},u=function(n,t){for(var i in n)if(n[i]&&n[i].name==t){n.splice(i,1);break}},c=function(n,t,i){document.cookie=n+"="+t+"; expires= + "+i+";path=/;"},l=function(){return n};return{Init:h,EventListener:r,SetCookie:c,FormSubmit:f,GetValues:l,RemoveItem:u}}();window.mtrDisableAutoInit||mtr_form.EventListener(window,"load",function(){mtr_form.Init()});(async function(){function r(){n.Widgets.Utilities.isTestMode()||(window.triggerbee.siteId=window.mtr_site_id,window.triggerbee.widgets.api=n.Widgets.WidgetApi.getDefault())}window.triggerbee=window.triggerbee||{};window.triggerbee.widgets=window.triggerbee.widgets||{};window.triggerbee.widgets.configurations=[{"id":4099,"campaignName":"Lead - Franchise","campaignId":3520,"urlSettings":{"includePaths":["/karriar/franchise/"],"excludePaths":[]},"triggers":[{"type":"Instantly"},{"type":"InactiveForXSeconds","value":"60"}],"conditions":[],"repetitions":[{"type":"Dismissal","option":"ContinueShowing"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":0,"states":[{"id":7482,"containers":[{"id":12588,"components":[{"id":42545,"type":"Text","subType":"TextRegular","script":"triggerbee.widgets.api.redirect(4099, '');return false;","listItems":[]},{"id":42547,"type":"InputText","subType":"InputTextEmail","script":"triggerbee.widgets.api.redirect(4099, '');return false;","listItems":[]},{"id":42549,"type":"Button","subType":"ButtonSubmit","script":"triggerbee.widgets.api.switchState(4099, 7483);","listItems":[]},{"id":42555,"type":"Checkbox","subType":"CheckboxConsent","script":"","listItems":[]},{"id":45131,"type":"InputText","subType":"InputTextPhone","script":"","listItems":[]}]},{"id":12589,"components":[{"id":42550,"type":"Button","subType":"ButtonHide","script":"triggerbee.widgets.api.close(4099);","listItems":[]}]}]},{"id":7483,"containers":[{"id":12590,"components":[{"id":42551,"type":"Text","subType":"TextRegular","script":"triggerbee.widgets.api.redirect(4099, '');return false;","listItems":[]},{"id":42553,"type":"Text","subType":"TextRegular","script":"triggerbee.widgets.api.redirect(4099, '');return false;","listItems":[]},{"id":42554,"type":"Button","subType":"ButtonRegular","script":"triggerbee.widgets.api.close(4099);","listItems":[]}]},{"id":38440,"components":[{"id":113998,"type":"Button","subType":"ButtonHide","script":"triggerbee.widgets.api.close(4099);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"usePartialFormSubmit":false},{"id":4293,"campaignName":"Lead - Marknadskommentar","campaignId":3693,"urlSettings":{"includePaths":["/bostadsindex/","/expertpanelenoktober/","/expertpanelen-juli/","/expertpanelen-april/","/expertpanelen/","/expertpanelen-januari/"],"excludePaths":[]},"triggers":[{"type":"Instantly"}],"conditions":[],"repetitions":[{"type":"Dismissal","option":"ContinueShowing"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":0,"states":[{"id":7765,"containers":[{"id":13300,"components":[{"id":44372,"type":"Text","subType":"TextRegular","script":"event.stopPropagation();triggerbee.widgets.api.redirect(4293, '');return false;","listItems":[]},{"id":44375,"type":"Button","subType":"ButtonSubmit","script":"event.stopPropagation();triggerbee.widgets.api.switchState(4293, 7766);","listItems":[]},{"id":44376,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]},{"id":44381,"type":"Text","subType":"TextRegular","listItems":[]},{"id":45130,"type":"InputText","subType":"InputTextEmail","listItems":[]}]},{"id":13301,"components":[{"id":44377,"type":"Button","subType":"ButtonHide","script":"event.stopPropagation();triggerbee.widgets.api.close(4293);","listItems":[]}]}]},{"id":7766,"containers":[{"id":13302,"components":[{"id":44378,"type":"Text","subType":"TextRegular","script":"event.stopPropagation();triggerbee.widgets.api.redirect(4293, '');return false;","listItems":[]},{"id":44379,"type":"Text","subType":"TextRegular","script":"event.stopPropagation();triggerbee.widgets.api.redirect(4293, '');return false;","listItems":[]},{"id":44380,"type":"Button","subType":"ButtonRegular","script":"event.stopPropagation();triggerbee.widgets.api.redirect(4293, 'https://www.erikolsson.se/marknadskommentar/');return false;","listItems":[]}]},{"id":38436,"components":[{"id":113982,"type":"Button","subType":"ButtonHide","script":"event.stopPropagation();triggerbee.widgets.api.close(4293);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"usePartialFormSubmit":false},{"id":6526,"campaignName":"Prenumerera Nyhetsbrev","campaignId":5470,"urlSettings":{"includePaths":["/efter-kampanj---vardera--bostaden/","/bostadsguiden/inredning/","/bostadsguiden/inredning/arets-fargtrend/","/bostadsguiden/inredning/balkongtrender-2021/","/bostadsguiden/inredning/blatt-ar-flatt/","/bostadsguiden/inredning/fargsatt-hemmakontoret/","/bostadsguiden/inredning/fyra-trender-2021/","/bostadsguiden/inredning/hostens-bostadstrender/","/bostadsguiden/inredning/kreativa-ideer-till-barnrummet/","/bostadsguiden/inredning/personligare-styling/","/bostadsguiden/inredning/sa-inreder-du-balkongen/","/bostadsguiden/inredning/sa-inreder-du-barnrummet/","/bostadsguiden/inredning/sa-stylar-vi-vara-hem-2021/","/bostadsguiden/inredning/smart-forvaring-till-hallen/","/bostadsguiden/inredning/smartare-forvaring/","/bostadsguiden/inredning/styla-hemmet-med-ratt-vaxter/","/bostadsguiden/inredning/trendiga-vaxter-2021/","/bostadsguiden/kopa--salja/","/bostadsguiden/kopa--salja/allt-om-din-boendekalkyl/","/bostadsguiden/kopa--salja/bli-en-smart-budgivare/","/bostadsguiden/kopa--salja/dolda-fel/","/bostadsguiden/kopa--salja/lanelofte-och-budgivning/","/bostadsguiden/kopa--salja/sa_fungerar_amorteringskravet/","/bostadsguiden/tips--rad/belysningstips/","/bostadsguiden/tips--rad/fonsterstyling/","/bostadsguiden/tips--rad/lyckas-med-flyttstadningen/","/bostadsguiden/tips--rad/mala-om-i-hemmet/","/bostadsguiden/tips--rad/sa-rengor-du-altanen/","/bostadsguiden/tips--rad/sa-skapar-du-ett-ergonomiskt-hemmakontor/","/bostadsguiden/tips--rad/skapa-ditt-dromkok/","/bostadsguiden/tips--rad/skillnaden-pa-att-aga-bostad-som-sambo-och-gift/","/bostadsguiden/tips--rad/tips-for-en-valvardad-tomt/","/bostadsguiden/unika-hem/","/bostadsguiden/unika-hem/dromhuset-i-limhamn/","/bostadsguiden/unika-hem/laskfabrikeniskarhamn/","/bostadsguiden/unika-hem/poolvilla-med-ljuvlig-tradgard/","/bostadsguiden/unika-hem/stockholms-mest-populara-gator/","/bostadsguiden/inredning/skapa_ett_personligt_hem_med_tapeter/","/bostadsguiden/tips--rad/ta-hand-om-din-trafasad/","/bostadsguiden/tips--rad/valj-kulor-till-dina-snickerier/","/bostadsguiden/tips--rad/sa-lyckas-du-med-fonsterputsningen/","/bostadsguiden/inredning/sa-maximerar-du-en-liten-bostadsyta/","/bostadsguiden/inredning/hemmakontoret/","/bostadsguiden/unika-hem/pooldrom-i-sundby/","/bostadsguiden/unika-hem/familjevilla-i-farsta/","/bostadsguiden/tips--rad/sa-stadar-du-effektivt/","/bostadsguiden/tips--rad/pandemins-effekt-pa-vara-hem/","/bostadsguiden/tips--rad/smart-forvaring-pa-hemmakontoret/","/bostadsguiden/inredning/sa_malar_du_om_i_badrummet/","/bostadsguiden/inredning/sa-malar-du-om-koksluckorna/","/bostadsguiden/unika-hem/arkitektritad-pal-ross-villa/","/bostadsguiden/tips--rad/stadar-smart-efter-en-renovering/","/bostadsguiden/unika-hem/smogen-villa/","/bostadsguiden/inredning/sa-skapar-du-ett-mysigt-sovrum/","/bostadsguiden/tips--rad/sa-valjer-du-ratt-snittblommor-till-visningen/","/bostadsguiden/tips--rad/skapa-en-valkomnande-entre-med-vaxter/","/bostadsguiden/inredning/hostens_trendigaste_kulor/","/bostadsguiden/inredning/skapa-en-lyxig-baddning-infor-visningen/","/bostadsguiden/inredning/sa-valjer-du-ratt-vas/","/bostadsguiden/inredning/fem-nyanser-av-vitt/","/bostadsguiden/unika-hem/intervju-med-pal-ross/","/bostadsguiden/tips--rad/sa-haller-du-dina-snittblommor-frascha/","/bostadsguiden/unika-hem/rastaborgs-slott/","/bostadsguiden/kopa--salja/ordlista/","/bostadsguiden/tips--rad/sju-tips-nar-du-ska-mala-om-i-hemmet/","/bostadsguiden/tips--rad/ett-skinande-rent-hem/","/bostadsguiden/tips--rad/stada-efter-julen/","/bostadsguiden/tips--rad/sakerhet-for-dig-som-bor-i-lagenhet/","/bostadsguiden/tips--rad/sakerhet-for-dig-som-bor-i-villa/","/bostadsguiden/tips--rad/fem-tips-om-hur-du-minskar-risken-for-stold/","/bostadsguiden/tips--rad/forandra-rummet-med-farg/","/bostadsguiden/tips--rad/sa-tapetserar-du-steg-for-steg2/","/bostadsguiden/tips--rad/sa-far-du-ner-elkostnaderna-i-10-steg/","/bostadsguiden/kopa--salja/lagt-utbud-av-bostader-i-januari/"],"excludePaths":[]},"triggers":[{"type":"AfterXPageviews","value":"2"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":9000,"option":"DisableShowingForXMinutes"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":0,"states":[{"id":11520,"containers":[{"id":22040,"components":[{"id":69049,"type":"InputText","subType":"InputTextEmail","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]},{"id":69050,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]},{"id":69051,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(6526, 11521);","listItems":[]},{"id":69052,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]},{"id":69053,"type":"Image","subType":"ImageRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]},{"id":69054,"type":"Checkbox","subType":"CheckboxConsent","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]}]},{"id":22041,"components":[{"id":69055,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(6526);","listItems":[]}]}]},{"id":11521,"containers":[{"id":22042,"components":[{"id":69057,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]},{"id":69058,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(6526, '');return false;","listItems":[]}]},{"id":22043,"components":[{"id":69059,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(6526);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"usePartialFormSubmit":false},{"id":13708,"campaignName":"Kundtjänst - Nyproduktion","campaignId":10996,"variantName":"Variant 2","urlSettings":{"includePaths":["/nyproduktion*"],"excludePaths":[]},"triggers":[{"type":"AfterXSeconds","value":"2"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":60,"option":"DisableShowingForXMinutes"},{"type":"Conversion","value":60,"option":"DisableShowingForXMinutes"}],"scheduling":{"customDays":[],"customHours":[]},"audienceId":"a6e77002-7595-465c-8b6b-3bd415418cc6","audience":{"id":"a6e77002-7595-465c-8b6b-3bd415418cc6","filters":[{"type":"Tags","value":"Bostadsutvecklare - Nyproduktion"}]},"isEmbedded":false,"order":0,"states":[{"id":23276,"containers":[{"id":48740,"components":[{"id":138979,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13708);","listItems":[]}]},{"id":48741,"components":[{"id":138980,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13708, '');return false;","listItems":[]},{"id":138981,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(13708, 23278);","listItems":[]},{"id":138982,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13708, 'https://www.erikolsson.se/kopa-bostad/bostadsbevakning/');return false;","listItems":[]},{"id":138983,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13708, 'https://www.erikolsson.se/nyproduktion/bostadsprojekt/');return false;","listItems":[]}]}]},{"id":23277,"containers":[{"id":48742,"components":[{"id":138984,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13708);","listItems":[]}]},{"id":48743,"components":[{"id":138985,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13708);","listItems":[]},{"id":138986,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13708, '');return false;","listItems":[]},{"id":138987,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13708, '');return false;","listItems":[]}]}]},{"id":23278,"containers":[{"id":48744,"components":[{"id":138988,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13708);","listItems":[]}]},{"id":48745,"components":[{"id":138989,"type":"InputText","subType":"InputTextPhone","listItems":[]},{"id":138990,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(13708, 23277);","listItems":[]},{"id":138991,"type":"Text","subType":"TextRegular","listItems":[]},{"id":138992,"type":"InputText","subType":"InputTextEmail","listItems":[]},{"id":138993,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Nyproduktion"],"usePartialFormSubmit":false},{"id":18831,"campaignName":"Värdebevakaren","campaignId":14945,"variantName":"Mobil","urlSettings":{"includePaths":["/om-oss*","/maklare*","/kopa-bostad*","/vara-omraden*","/om-oss/kontor","/bostader-till-salu*","/salja-bostad*"],"excludePaths":[]},"triggers":[{"type":"AfterXPageviews","value":"2"}],"conditions":[{"type":"OnlyMobile","show":true,"operator":"Equals"}],"repetitions":[{"type":"Dismissal","value":10080,"option":"DisableShowingForXMinutes"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":0,"states":[{"id":30812,"containers":[{"id":66810,"components":[{"id":183367,"type":"Text","subType":"TextRegular","listItems":[]}]},{"id":66811,"components":[{"id":183368,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(18831, 'https://www.erikolsson.se/fokus/vardeindikator/?utm_source=triggerbee&utm_medium=popup&utm_campaign=eo_fokus_kampanj_10_alla');return false;","listItems":[]},{"id":183375,"type":"Text","subType":"TextRegular","listItems":[]}]},{"id":66812,"components":[{"id":183369,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(18831);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Sälja bostad"],"usePartialFormSubmit":false},{"id":58014,"campaignName":"Kundtjänst AB-test","campaignId":43056,"urlSettings":{"includePaths":["/","/om-oss/*","/vara-omraden*","/varberg","/maklare*","/kopa-bostad*","/bostadsguiden*","/nordic-nest/","/bostad-saknas","/sok/","/socialt-och-event*","/tack*","/kampanjsida-varmdo","/personuppgiftspolicy/","/cookies/","/kampanj-sastaholm-herrgard/","/webblasaren-stods-inte/","/bast-betalt","/vara-kunder-rekommenderar-oss-vidare/","/aaf2022/","/efter-kampanj---vardera--bostaden/","/kampanjsida_arsta_enskede_ellery/","/karriar*","/marknadskommentar/","/salja-bostad*","/personuppgiftspolicy","/bostadsindex/","/fokus*"],"excludePaths":["/bostader-till-salu/"]},"triggers":[{"type":"AfterXSeconds","value":"2"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":60,"option":"DisableShowingForXMinutes"},{"type":"Conversion","value":60,"option":"DisableShowingForXMinutes"}],"scheduling":{"customDays":[],"customHours":[]},"responseListId":"80511c12-246c-4a25-b652-16871369276c","isEmbedded":false,"order":0,"states":[{"id":84225,"containers":[{"id":188759,"components":[{"id":509796,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, '');return false;","listItems":[]},{"id":509797,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, 'https://www.erikolsson.se/boka-tid/');return false;","listItems":[]},{"id":509798,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, 'https://www.erikolsson.se/kopa-bostad/bostadsbevakning/');return false;","listItems":[]},{"id":509799,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, 'https://www.erikolsson.se/vi-hjalper-dig/');return false;","listItems":[]},{"id":509800,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, 'https://www.erikolsson.se/salja-bostad');return false;","listItems":[]}]},{"id":188760,"components":[{"id":509801,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(58014);","listItems":[]}]}]},{"id":84226,"containers":[{"id":188761,"components":[{"id":509802,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, '');return false;","listItems":[]},{"id":509803,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(58014, '');return false;","listItems":[]},{"id":509804,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.close(58014);","listItems":[]}]},{"id":188762,"components":[{"id":509805,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(58014);","listItems":[]}]}]},{"id":84227,"containers":[{"id":188763,"components":[{"id":509806,"type":"InputText","subType":"InputTextPhone","listItems":[]},{"id":509807,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(58014, 84225, this);","listItems":[]},{"id":509808,"type":"Text","subType":"TextRegular","listItems":[]},{"id":509809,"type":"InputText","subType":"InputTextEmail","listItems":[]},{"id":509810,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]}]},{"id":188764,"components":[{"id":509811,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(58014);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"formType":"Default","usePartialFormSubmit":false},{"id":70802,"campaignName":"Kundtjänst - Bostäder till salu","campaignId":51485,"triggers":[{"type":"AfterXSeconds","value":"30"},{"type":"Scroll","value":"80"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":60,"option":"DisableShowingForXMinutes"},{"type":"Conversion","value":60,"option":"DisableShowingForXMinutes"}],"scheduling":{"customDays":[],"customHours":[]},"responseListId":"80511c12-246c-4a25-b652-16871369276c","isEmbedded":false,"order":0,"states":[{"id":100924,"containers":[{"id":227932,"components":[{"id":628374,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, '');return false;","listItems":[]},{"id":628375,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, 'https://www.erikolsson.se/boka-tid/');return false;","listItems":[]},{"id":628376,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, 'https://www.erikolsson.se/kopa-bostad/bostadsbevakning/');return false;","listItems":[]},{"id":628377,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, 'https://www.erikolsson.se/vi-hjalper-dig/');return false;","listItems":[]},{"id":628378,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, 'https://www.erikolsson.se/salja-bostad');return false;","listItems":[]}]},{"id":227933,"components":[{"id":628379,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70802);","listItems":[]}]}]},{"id":100925,"containers":[{"id":227934,"components":[{"id":628380,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, '');return false;","listItems":[]},{"id":628381,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70802, '');return false;","listItems":[]},{"id":628382,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70802);","listItems":[]}]},{"id":227935,"components":[{"id":628383,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70802);","listItems":[]}]}]},{"id":100926,"containers":[{"id":227936,"components":[{"id":628384,"type":"InputText","subType":"InputTextPhone","listItems":[]},{"id":628385,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(70802, 100924, this);","listItems":[]},{"id":628386,"type":"Text","subType":"TextRegular","listItems":[]},{"id":628387,"type":"InputText","subType":"InputTextEmail","listItems":[]},{"id":628388,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]}]},{"id":227937,"components":[{"id":628389,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70802);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"formType":"Default","usePartialFormSubmit":false},{"id":71539,"campaignName":"Värdebevakaren - exitpopup","campaignId":51937,"variantName":"Variant 3","urlSettings":{"includePaths":["/bostadsguiden*","/boka-visning*","/vara-omraden*","/kopa-bostad*","/maklare*","/bostad-saknas*","/om-oss*"],"excludePaths":["/bostader-till-salu/*"]},"triggers":[{"type":"ExitIntent"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":10080,"option":"DisableShowingForXMinutes"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"startDate":"2023-12-01","endDate":"2024-12-31","customDays":[],"customHours":[]},"sessionConditionGroupId":0,"isEmbedded":false,"order":0,"states":[{"id":101891,"containers":[{"id":230220,"components":[{"id":634347,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(71539);","listItems":[]}]},{"id":230221,"components":[{"id":634348,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":634349,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":634350,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":634351,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":634352,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":634353,"type":"Text","subType":"TextRegular","listItems":[]},{"id":634354,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(71539, 'https://www.erikolsson.se/fokus/vardeindikator/?utm_source=triggerbee&utm_medium=popup&utm_campaign=eo_fokus_kampanj_10_alla');return false;","listItems":[]},{"id":634355,"type":"Text","subType":"TextRegular","listItems":[]},{"id":634356,"type":"Spacer","subType":"SpacerRegular","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Sälja bostad"],"usePartialFormSubmit":false},{"id":89311,"campaignName":"Värdebevakaren - tid på sidan","campaignId":63941,"variantName":"Variant 3","urlSettings":{"includePaths":["/bostader-till-salu/*"],"excludePaths":[]},"triggers":[{"type":"AfterXSeconds","value":"90"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":10080,"option":"DisableShowingForXMinutes"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"startDate":"2023-12-01","endDate":"2024-12-31","customDays":[],"customHours":[]},"sessionConditionGroupId":0,"isEmbedded":false,"order":0,"states":[{"id":125357,"containers":[{"id":282551,"components":[{"id":785417,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(89311);","listItems":[]}]},{"id":282552,"components":[{"id":785418,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":785419,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":785420,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":785421,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":785422,"type":"Spacer","subType":"SpacerRegular","listItems":[]},{"id":785423,"type":"Text","subType":"TextRegular","listItems":[]},{"id":785424,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(89311, 'https://www.erikolsson.se/fokus/vardeindikator/?utm_source=triggerbee&utm_medium=popup&utm_campaign=eo_fokus_kampanj_10_alla');return false;","listItems":[]},{"id":785425,"type":"Text","subType":"TextRegular","listItems":[]},{"id":785426,"type":"Spacer","subType":"SpacerRegular","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Sälja bostad"],"usePartialFormSubmit":false},{"id":13704,"campaignName":"Kundtjänst - Nyproduktion","campaignId":10996,"variantName":"Variant 1","urlSettings":{"includePaths":["/nyproduktion*"],"excludePaths":[]},"triggers":[{"type":"AfterXSeconds","value":"2"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":60,"option":"DisableShowingForXMinutes"},{"type":"Conversion","value":60,"option":"DisableShowingForXMinutes"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":1,"states":[{"id":23266,"containers":[{"id":48723,"components":[{"id":138947,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13704);","listItems":[]}]},{"id":48724,"components":[{"id":138943,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, '');return false;","listItems":[]},{"id":138944,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, 'https://www.erikolsson.se/nyproduktion/kopa-nyproduktion/');return false;","listItems":[]},{"id":138945,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, 'https://www.erikolsson.se/kopa-bostad/bostadsbevakning/');return false;","listItems":[]},{"id":138946,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, 'https://www.erikolsson.se/nyproduktion/bostadsprojekt/');return false;","listItems":[]}]}]},{"id":23267,"containers":[{"id":48721,"components":[{"id":138925,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13704);","listItems":[]}]},{"id":48722,"components":[{"id":138927,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13704);","listItems":[]},{"id":138928,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, '');return false;","listItems":[]},{"id":138948,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(13704, '');return false;","listItems":[]}]}]},{"id":23268,"containers":[{"id":48719,"components":[{"id":138911,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(13704);","listItems":[]}]},{"id":48720,"components":[{"id":138906,"type":"InputText","subType":"InputTextPhone","listItems":[]},{"id":138907,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(13704, 23266);","listItems":[]},{"id":138908,"type":"Text","subType":"TextRegular","listItems":[]},{"id":138909,"type":"InputText","subType":"InputTextEmail","listItems":[]},{"id":138910,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Nyproduktion"],"usePartialFormSubmit":false},{"id":18833,"campaignName":"Värdebevakaren","campaignId":14945,"variantName":"Desktop","urlSettings":{"includePaths":["/om-oss*","/maklare*","/kopa-bostad*","/vara-omraden*","/om-oss/kontor","/bostader-till-salu*","/salja-bostad*"],"excludePaths":[]},"triggers":[{"type":"AfterXPageviews","value":"2"}],"conditions":[{"type":"OnlyDesktop","show":true,"operator":"Equals"}],"repetitions":[{"type":"Dismissal","value":10080,"option":"DisableShowingForXMinutes"},{"type":"Conversion","option":"DontShowAgain"}],"scheduling":{"customDays":[],"customHours":[]},"isEmbedded":false,"order":1,"states":[{"id":30814,"containers":[{"id":66816,"components":[{"id":183376,"type":"Text","subType":"TextRegular","listItems":[]},{"id":183380,"type":"Text","subType":"TextRegular","listItems":[]}]},{"id":66817,"components":[{"id":183377,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(18833, 'https://www.erikolsson.se/fokus/vardeindikator/?utm_source=triggerbee&utm_medium=popup&utm_campaign=eo_fokus_kampanj_10_alla');return false;","listItems":[]},{"id":183378,"type":"Text","subType":"TextRegular","listItems":[]}]},{"id":66818,"components":[{"id":183379,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(18833);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":["Sälja bostad"],"usePartialFormSubmit":false},{"id":70801,"campaignName":"Kundtjänst - Bostäder till salu","campaignId":51485,"triggers":[{"type":"AfterXSeconds","value":"30"},{"type":"Scroll","value":"80"}],"conditions":[],"repetitions":[{"type":"Dismissal","value":60,"option":"DisableShowingForXMinutes"},{"type":"Conversion","value":60,"option":"DisableShowingForXMinutes"}],"scheduling":{"customDays":[],"customHours":[]},"responseListId":"80511c12-246c-4a25-b652-16871369276c","isEmbedded":false,"order":1,"states":[{"id":100921,"containers":[{"id":227926,"components":[{"id":628359,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, '');return false;","listItems":[]},{"id":628360,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, 'https://www.erikolsson.se/boka-tid/');return false;","listItems":[]},{"id":628361,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, 'https://www.erikolsson.se/kopa-bostad/bostadsbevakning/');return false;","listItems":[]},{"id":628362,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, 'https://www.erikolsson.se/vi-hjalper-dig/');return false;","listItems":[]}]},{"id":227927,"components":[{"id":628363,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70801);","listItems":[]}]}]},{"id":100922,"containers":[{"id":227928,"components":[{"id":628364,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, '');return false;","listItems":[]},{"id":628365,"type":"Text","subType":"TextRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.redirect(70801, '');return false;","listItems":[]},{"id":628366,"type":"Button","subType":"ButtonRegular","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70801);","listItems":[]}]},{"id":227929,"components":[{"id":628367,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70801);","listItems":[]}]}]},{"id":100923,"containers":[{"id":227930,"components":[{"id":628368,"type":"InputText","subType":"InputTextPhone","listItems":[]},{"id":628369,"type":"Button","subType":"ButtonSubmit","script":"event && event.stopPropagation();triggerbee.widgets.api.switchState(70801, 100921, this);","listItems":[]},{"id":628370,"type":"Text","subType":"TextRegular","listItems":[]},{"id":628371,"type":"InputText","subType":"InputTextEmail","listItems":[]},{"id":628372,"type":"Checkbox","subType":"CheckboxConsent","listItems":[]}]},{"id":227931,"components":[{"id":628373,"type":"Button","subType":"ButtonHide","script":"event && event.stopPropagation();triggerbee.widgets.api.close(70801);","listItems":[]}]}]}],"campaignType":"Regular","conditionsAndAudienceOperation":"And","tags":[],"formType":"Default","usePartialFormSubmit":false}];window.triggerbee.widgets.resourcesUrl="https://widget-resources.triggerbee.com";window.triggerbee.widgets.clientGatewayUrl="https://site-gw.triggerbee.com";window.triggerbee.widgets.emailProviderQueryStrings=["utm_custom[rm]=","mc_eid=","eclub=","utm_custom[apsis]=","_klaviyopid=","_emarsyspid=","cb="];var t=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(n){f(n)}}function s(n){try{e(r.throw(n))}catch(n){f(n)}}function e(n){var t;n.done?u(n.value):(t=n.value,t instanceof i?t:new i(function(n){n(t)})).then(o,s)}e((r=r.apply(n,t||[])).next())})},i=this&&this.__decorate||function(n,t,i,r){var f,e=arguments.length,u=e<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r,o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(f=n[o])&&(u=(e<3?f(u):e>3?f(t,i,u):f(t,i))||u);return e>3&&u&&Object.defineProperty(t,i,u),u},n;!function(n){!function(n){n.AbTestingCampaignService=(class{constructor(n){this.tracker=n}getWidgetToShow(n,t){const i=this.tracker.getPerson();i.abTestingWidgetIds&&!Array.isArray(i.abTestingWidgetIds)||(i.abTestingWidgetIds={});let r=i.abTestingWidgetIds[n];if(!r){const u=Math.floor(Math.random()*Math.floor(t.length));r=t[u].id;i.abTestingWidgetIds[n]=r;this.tracker.setPerson(i)}return t.find(n=>n.id===r)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){!function(n){n.CustomElement=function(n){const t=()=>{};return function(i){(n=>{if(n.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");})(n.selector);const r=document.createElement("template");n.style&&(n.template=`<style>${n.style}</style> ${n.template}`);r.innerHTML=n.template;const u=i.prototype.connectedCallback||t,f=i.prototype.disconnectedCallback||t;i.prototype.connectedCallback=function(){const t=document.importNode(r.content,!0);n.useShadow?this.attachShadow({mode:"open"}).appendChild(t):this.appendChild(t);this.componentWillMount&&this.componentWillMount();u.call(this);this.componentDidMount&&this.componentDidMount()};i.prototype.disconnectedCallback=function(){this.componentWillUnmount&&this.componentWillUnmount();f.call(this);this.componentDidUnmount&&this.componentDidUnmount()};window.customElements.get(n.selector)||window.customElements.define(n.selector,i)}}}(n.WebComponents||(n.WebComponents={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.DiscountCodeService=(class{constructor(n,t,i,r,u,f,e,o,s){this.logger=n;this.trackerService=t;this.utilities=i;this.widgetUtilities=r;this.visitorStateService=u;this.httpClient=f;this.windowProvider=e;this.tracker=o;this.widgetPreviewService=s;this.componentIdsEventsLogged=[];this.previewText="EXAMPLE-COUPON";this.window=this.windowProvider.get()}setCodeAsFallbackCode(n,t,i){var u;let f=null!==(u=null==t?void 0:t.fallback)&&void 0!==u?u:"";this.widgetPreviewService.isPreview()&&(f=this.previewText);const r=i.querySelector(`div[data-id="${n}"]`).querySelector(".text-content.actual-element.code-wrapper"),e=r.querySelector(".code");e.innerText=f;e.style.backgroundColor=r.style.backgroundColor;this.showSpinner(r);setTimeout(()=>{this.showCode(r)},1500)}getAndSetOneTimeCode(n,i,r,u){var f,e;return t(this,void 0,void 0,function*(){r.fallback=null!==(f=null==r?void 0:r.fallback)&&void 0!==f?f:"";const h=u.querySelector(`div[data-id="${i}"]`),t=h.querySelector(".text-content.actual-element.code-wrapper"),o=t.querySelector(".code");o.innerText=r.fallback;o.style.backgroundColor=t.style.backgroundColor;h.querySelector(".copied-text-wrapper").querySelector("span").innerText=null!==(e=null==r?void 0:r.copyMessage)&&void 0!==e?e:"Copied!";this.showSpinner(t);let c=!1;setTimeout(()=>{c=!0},1500);const l=n=>{o&&(o.innerText=n,o.style.backgroundColor=t.style.backgroundColor,this.showCode(t))};let s=yield this.getCode(n,r,i);const a=setInterval(()=>{c&&null!=s&&null!=s&&(clearInterval(a),l(s))},50)})}getCode(i,r,u){var f,e,o,s,h,c,l;return t(this,void 0,void 0,function*(){if(this.widgetPreviewService.isPreview())return this.previewText;let a=this.visitorStateService.getCurrentState();a.usedSingleCoupons=a.usedSingleCoupons||[];let v=a.usedSingleCoupons.find(n=>n.id==this.getCacheKey(u,r));if(v)return null!==(f=v.code)&&void 0!==f?f:"";let t="";try{const f=yield this.getCodeFromServer(i,r.couponSetId);if((null===(e=null==f?void 0:f.data)||void 0===e?void 0:e.code)&&0!==(null===(o=null==f?void 0:f.data)||void 0===o?void 0:o.code.trim().length)&&200==f.statusCode){if(t=null!==(c=f.data.code)&&void 0!==c?c:"",t&&t.length>0){let i=new n.usedSingleCoupons;i.code=t;i.id=this.getCacheKey(u,r);a.usedSingleCoupons.push(i);this.visitorStateService.setCurrentState(a)}}else this.logger.warn(`No coupon recieved. HTTP Status: '${f.statusCode}'. Code: '${null===(s=null==f?void 0:f.data)||void 0===s?void 0:s.code}'`),t=r.fallback=null!==(h=null==r?void 0:r.fallback)&&void 0!==h?h:""}catch(n){t=r.fallback=null!==(l=null==r?void 0:r.fallback)&&void 0!==l?l:""}return t})}getCacheKey(n,t){return n+"-"+t.couponSetId}showSpinner(n){const t=n?n.querySelector(".coupon-spinner"):null,i=n?n.querySelector(".code"):null,r=n?n.querySelector(".copy-button-wrapper"):null;i.classList.add("invisible");t.classList.remove("hidden");r.classList.add("hidden")}showCode(n){const t=n?n.querySelector(".coupon-spinner"):null,i=n?n.querySelector(".code"):null,r=n?n.querySelector(".copy-button-wrapper"):null;i.classList.remove("invisible");t.classList.add("hidden");r.classList.remove("hidden")}getCodeFromServer(n,i){return t(this,void 0,void 0,function*(){const t=this.widgetUtilities.getCurrentSiteId(),r=this.tracker.getUid(),u=`${this.window.triggerbee.widgets.clientGatewayUrl}/widgets/${n.id}/coupon-code/${i}?siteId=${t}&uid=${r}`;return yield this.httpClient.getAsync(u)})}copyDiscountCode(n){const t=n.closest(".component-discountcode"),i=t.getAttribute("data-copy"),r=t.querySelector(`[data-component="${i}"]`),u=this.utilities.copyToClipboard(r);this.logger.debug(`Copied text '${u}' of component '${i}' to clipboard`);t.classList.add("copied");const f=+this.utilities.getClosestElement("triggerbee-widget",t).getAttribute("data-id"),e=this.getComponentId(t);this.logEvents(f,e,!1)}addDiscountCodeEvents(n){n.shadowRoot.querySelectorAll(".component-discountcode").forEach(t=>{const i=t.querySelector(".component-text");i.addEventListener("click",()=>{const r=+n.getAttribute("data-id"),u=this.getComponentId(t);this.logEvents(r,u,!0);const f=i.querySelector("p");this.selectElementText(f)})})}logEvents(n,t,i){if(this.isEventsLogged(t))this.logger.debug("Event already logged to tracker");else{const u=this.widgetUtilities.getWidgetbyId(n).campaignId,r=this;this.trackerService.logGoal(`oc_discount_${n}`,function(){i?r.trackerService.logCouponCopied(n,u,()=>{r.componentIdsEventsLogged.push(t)}):r.trackerService.logClickThrough(n,u,()=>{r.componentIdsEventsLogged.push(t)})})}}isEventsLogged(n){return this.componentIdsEventsLogged.some(t=>t==n)}getComponentId(n){return+n.querySelector(".component-text").getAttribute("data-component")}selectElementText(n,t){var u,i,r=(t=t||window).document;t.getSelection&&r.createRange?(u=t.getSelection(),(i=r.createRange()).selectNodeContents(n),u.removeAllRanges(),u.addRange(i)):r.body.createTextRange&&((i=r.body.createTextRange()).moveToElementText(n),i.select())}handleAllSingleUseDiscountComponents(t,i,r){var u;let f=null===(u=null==i?void 0:i.containers)||void 0===u?void 0:u.reduce((t,i)=>{var r;const u=(null===(r=i.components)||void 0===r?void 0:r.filter(t=>t.subType===n.ComponentSubType.ShareCouponCode))||[];return t.concat(u)},[]).filter(n=>null!=n&&null!=n);f&&f.forEach(n=>{var i;(null===(i=n.couponCodeProperties)||void 0===i?void 0:i.couponSetId)?this.getAndSetOneTimeCode(t,n.id,n.couponCodeProperties,r):this.setCodeAsFallbackCode(n.id,n.couponCodeProperties,r);this.setUpCopyButton(r,n.id,t.id)})}setUpCopyButton(n,t,i){const f=n.querySelector(`div[data-id="${t}"]`),r=f.querySelector(".text-content.actual-element.code-wrapper"),e=r.querySelector(".code");let u;f.querySelector(".copy-button").addEventListener("click",()=>{void 0!==u&&clearTimeout(u);const n=r?r.querySelector(".copied-text-wrapper"):null;this.logEvents(i,t,!0);u=this.widgetUtilities.copyText(n,e)})}});n.CouponCodeResponse=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.FormsService=(class{constructor(n,t,i,r,u,f,e){this.logger=n;this.httpClient=t;this.windowProvider=i;this.trackerService=r;this.widgetUtilities=u;this.visitorStateService=f;this.utilities=e;this.window=this.windowProvider.get()}checkIsSubscriber(n,i){return t(this,void 0,void 0,function*(){const t=`${this.window.triggerbee.widgets.clientGatewayUrl}/subscribers/${n}/check`;return(yield this.httpClient.postAsync(t,{siteId:this.widgetUtilities.getCurrentSiteId(),widgetId:i})).data})}getFormFields(n,t){return[...n.querySelectorAll(t||"input,textarea,select")]}validateFormFieldsInState(n,t=!0){let i=!0;var r=this.getFormFields(n).reverse();return r.length>0&&r.forEach(n=>{(t?n.reportValidity():n.checkValidity())||(i=!1)}),i}getFormData(n){let t={};const i=this.getFormFields(n);for(let n of i){let u=n.getAttribute("name");if(u){const r=n;let i=r.value;if("checkbox"===r.type&&(i=n.checked.toString()),"tel"===r.type&&(i=i.replace(/[\s()-]/g,"")),n.classList.contains("button-list-component-value")){const t=n.closest(".actual-element").querySelector(".widget-component-button-list-item.checked .additional-field input");t&&(i=this.replaceAdditionalFieldValue(i,t))}t[u]=i}}return t}replaceAdditionalFieldValue(n,t){const i=t.value;if(n.indexOf(";")>-1){const r=t.closest(".widget-component-button-list-item.checked");if(r){const t=r.getAttribute("data-value");n=n.replace(t,i)}else this.logger.error("Could not find expected item by selector: .widget-component-button-list-item.checked")}else n=i;return n}partialSubmit(n,t,i=void 0){const r=this.widgetUtilities.getWidgetbyId(n);if(r&&r.usePartialFormSubmit){if(!r.responseListId)return void this.logger.warn(`No responseListId found for widget with ID: ${r.id}`);const o=this.widgetUtilities.getWidgetElementById(n);if(!o)return void this.logger.warn(`No widget element found for widget with ID: ${n}`);const f=o.shadowRoot.querySelector("form");if(!f)return void this.logger.warn(`No form element found for widget with ID: ${n}`);if(i&&i.classList.contains("state-teaser"))return void this.logger.debug(`Partial submit NOT logged for widget with ID '${r.id}'. Switching from Teaser`);const e=this.getFormData(f),u={widgetId:r.id,responseListId:r.responseListId,submitPath:this.window.location.pathname,formData:e};this.hasAnyFormDataValue(e)?this.visitorStateService.hasPartialSubmit(r,u)?this.logger.debug(`Partial submit NOT logged for widget with ID '${r.id}'. Data is same as previous attempt`):(this.trackerService.setCustomData(u.formData),t&&this.logConsent(r,f,e),this.trackerService.logPartialSubmit(r,u,()=>{this.visitorStateService.addPartialSubmit(r,u),this.logger.debug(`Partial submit logged for widget with ID '${n}'. Data: '${JSON.stringify(u)}'`)})):this.logger.debug(`Partial submit NOT logged for widget with ID '${r.id}'. None of form fields has a value`)}}isConsentElementVisible(n){const t=this.getConsentContainer(n);return t&&this.utilities.isElementCurrentlyVisible(t)}hasAnyFormDataValue(n){for(var t in n)if(n[t])return!0;return!1}logConsent(n,t,i){const r=t.querySelector("#triggerbee-consent-container");if(r){const t=this.widgetUtilities.getWidgetbyId(n.id).campaignName,u=r.querySelector(".checkbox-label").textContent;this.trackerService.setCustomData({"consent-checkbox":i["consent-checkbox"]});this.trackerService.logConsent(t,u,!0)}}getConsentContainer(n){if(n)return n.querySelector("#triggerbee-consent-container")}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt;n.Widget=(class{}),function(n){n.None="None";n.Impression="Impression"}(t=n.AttributionType||(n.AttributionType={})),function(n){n.Nps="Nps";n.Csat="Csat"}(i=n.ResponseListType||(n.ResponseListType={})),function(n){n.Dots="Dots";n.ProgressBar="ProgressBar"}(r=n.SlidingFormProgressStyle||(n.SlidingFormProgressStyle={}));n.Audience=(class{});n.AudienceFilter=(class{}),function(n){n.Identified="Identified";n.Consent="Consent";n.Goals="Goals";n.AppList="AppList";n.AppSegment="AppSegment";n.Tags="Tags";n.AppLabels="AppLabels"}(u=n.AudienceFilterType||(n.AudienceFilterType={}));n.SessionConditionGroup=(class{}),function(n){n.And="And";n.Or="Or"}(f=n.SessionConditionGroupOperator||(n.SessionConditionGroupOperator={}));n.State=(class{});n.Container=(class{}),function(n){n.SlideIn="SlideIn";n.Marquee="Marquee"}(e=n.ContainerEffectType||(n.ContainerEffectType={})),function(n){n.Left="Left";n.Right="Right";n.Up="Up";n.Down="Down"}(o=n.RelativeDirection||(n.RelativeDirection={})),function(n){n.Top="Top";n.Bottom="Bottom";n.Left="Left";n.Right="Right";n.Center="Center"}(s=n.AnimationStartPosition||(n.AnimationStartPosition={}));n.Component=(class{});n.ButtonListProperties=(class{});n.CountrySelectProperties=(class{}),function(n){n.Name="name";n.Iso="iso";n.Native="native";n.DialCode="dialCode"}(h=n.CountryLabel||(n.CountryLabel={}));n.CouponCodeProperties=(class{});n.CodeEditorProperties=(class{});n.ListItem=(class{});n.DeadlineProperties=(class{});n.ProductRecommendationProperties=(class{}),function(n){n.SiftLaB="SiftLab"}(c=n.ProductRecommendationApp||(n.ProductRecommendationApp={}));n.WidgetTransition=(class{}),function(n){n.ToneIn="ToneIn";n.SlideInLeft="SlideInLeft";n.SlideInRight="SlideInRight";n.SlideInTop="SlideInTop";n.SlideInBottom="SlideInBottom";n.WiggleIn="WiggleIn";n.Reset="Reset"}(l=n.EntryAnimationType||(n.EntryAnimationType={})),function(n){n.ToneOut="ToneOut";n.SlideOutLeft="SlideOutLeft";n.SlideOutRight="SlideOutRight";n.SlideOutTop="SlideOutTop";n.SlideOutBottom="SlideOutBottom";n.MorphNextState="MorphNextState"}(a=n.ExitAnimationType||(n.ExitAnimationType={})),function(n){n.Template="Template";n.Regular="Regular";n.ABTesting="ABTesting";n.Survey="Survey"}(v=n.CampaignType||(n.CampaignType={})),function(n){n.Replace="Replace";n.AppendChild="AppendChild";n.AppendChildFirst="AppendChildFirst";n.AppendSiblingBefore="AppendSiblingBefore";n.AppendSiblingAfter="AppendSiblingAfter"}(y=n.EmbedMethod||(n.EmbedMethod={})),function(n){n.OnlyOnce="OnlyOnce";n.EveryDay="EveryDay"}(p=n.DeadlineOccurence||(n.DeadlineOccurence={})),function(n){n.Text="Text";n.Image="Image";n.Spacer="Spacer";n.Button="Button";n.InputText="InputText";n.Checkbox="Checkbox";n.DiscountCode="DiscountCode";n.Group="Group";n.BulletList="BulletList";n.Deadline="Deadline";n.ButtonList="ButtonList";n.InternationalPhone="InternationalPhone";n.Share="Share";n.ShareCampaign="ShareCampaign";n.CodeEditor="CodeEditor"}(w=n.ComponentType||(n.ComponentType={})),function(n){n.TextRegular="TextRegular";n.TextFloating="TextFloating";n.TextCopy="TextCopy";n.ImageRegular="ImageRegular";n.ImageFloating="ImageFloating";n.SpacerRegular="SpacerRegular";n.ButtonRegular="ButtonRegular";n.ButtonFloating="ButtonFloating";n.ButtonSubmit="ButtonSubmit";n.ButtonInstagramFollow="ButtonInstagramFollow";n.ButtonHide="ButtonHide";n.ButtonShare="ButtonShare";n.InputTextRegular="InputTextRegular";n.InputTextEmail="InputTextEmail";n.InputTextName="InputTextName";n.InputTextFirstName="InputTextFirstName";n.InputTextLastName="InputTextLastName";n.InputTextPhone="InputTextPhone";n.InputTextArea="InputTextArea";n.CheckboxConsent="CheckboxConsent";n.DiscountCodeRegular="DiscountCodeRegular";n.ShareCouponCode="ShareCouponCode";n.CodeEditorHtml="CodeEditorHtml";n.ShareCampaignGroup="ShareCampaignGroup";n.GroupRegular="GroupRegular";n.BulletListRegular="BulletListRegular";n.DeadlineRegular="DeadlineRegular";n.ButtonListRadio="ButtonListRadio";n.ButtonListChoices="ButtonListChoices";n.ButtonListStarRating="ButtonListStarRating";n.ButtonListSmileyRating="ButtonListSmileyRating";n.ButtonListNumericalRating="ButtonListNumericalRating";n.ButtonListNpsRating="ButtonListNpsRating";n.ButtonListThumbRating="ButtonListThumbRating";n.ButtonListCsatStarRating="ButtonListCsatStarRating";n.ButtonListCsatSmileyRating="ButtonListCsatSmileyRating";n.ButtonListCsatNumericalRating="ButtonListCsatNumericalRating";n.DateRegular="DateRegular";n.DropdownRegular="DropdownRegular";n.ButtonListCheckbox="ButtonListCheckbox";n.PlaceholderRegular="PlaceholderRegular";n.ProductRecommendationRegular="ProductRecommendationRegular";n.IFrameRegular="IFrameRegular";n.InternationalPhoneRegular="InternationalPhoneRegular"}(b=n.ComponentSubType||(n.ComponentSubType={})),function(n){n.Blink="Blink";n.FancyBlink="FancyBlink"}(k=n.SelectEffect||(n.SelectEffect={})),function(n){n.MinutesSeconds="MinutesSeconds";n.HoursMinutesSeconds="HoursMinutesSeconds";n.DaysHoursMinutes="DaysHoursMinutes";n.DaysHoursMinutesSeconds="DaysHoursMinutesSeconds";n.Days="Days";n.Hours="Hours"}(d=n.DeadlineFormat||(n.DeadlineFormat={})),function(n){n.And="And";n.Or="Or"}(g=n.ConditionsAndAudienceOperation||(n.ConditionsAndAudienceOperation={})),function(n){n.Default="Default";n.MultiStep="MultiStep"}(nt=n.WidgetFormType||(n.WidgetFormType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ScoresService=(class{constructor(n){this.mtr=n}setScore(t,i,r){if(r.responseListType&&r.scoreColumn){t={responseListType:r.responseListType,scoreColumn:r.scoreColumn};let u=parseInt(i[r.scoreColumn]);if(u){let t=this.mtr.getVisit();r.responseListType==n.ResponseListType.Csat&&(t.csatScore=u);r.responseListType==n.ResponseListType.Nps&&(t.npsScore=u);this.mtr.setVisit(t)}}return t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.TrackerService=(class{constructor(n,t,i){this.logger=n;this.mtr=t;this.widgetPreviewService=i}logGoal(n,t){!this.widgetPreviewService.getTemplatePreviewParameterValue()?this.mtr.goal(n,t):t&&t()}logWidgetOpened(n,t,i){this.logWidgetEvent("open",n,t,i)}logWidgetClosed(n,t,i){this.logWidgetEvent("dismissal",n,t,i)}logClickThrough(n,t,i){this.logWidgetEvent("clickthrough",n,t,i)}logWidgetShare(n,t,i){this.logWidgetEvent("share",n,t,i)}logCouponCopied(n,t,i){this.logWidgetEvent("copy-coupon",n,t,i)}logSubmit(n,t,i,r){"survey-response"===n?this.logSurveyResponse(t,i,r):this.logConversion(t,i,r)}logPartialSubmit(t,i,r){const u=t.campaignType==n.CampaignType.Survey?"widget-survey-response-partial":"widget-conversion-partial";this.mtr.logEvent({name:u,id:i.widgetId.toString(),data:i,callback:r})}logEvent(n){!this.widgetPreviewService.getTemplatePreviewParameterValue()?this.mtr.logEvent(n):n.callback&&n.callback()}logAttribution(n){this.logEvent({name:"attribution",id:n})}logConversion(n,t,i){this.logWidgetEvent("conversion",n,t,i)}logSurveyResponse(n,t,i){this.logWidgetEvent("survey-response",n,t,i)}logWidgetEvent(n,t,i,r){this.widgetPreviewService.isPreview()?(this.logger.debug(`Widget-event '${n}' NOT logged to tracker for widget '${t}' because this is preview`),r&&r()):this.mtr.widget(n,t,i,r)}setCustomData(n){const t=window.mtr_custom||{};t.session||(t.session={});for(let i in n)t.session[i]=n[i];window.mtr_custom=t}logConsent(n,t,i){const r=window.mtr_consent;r?r.logConsent(n,t,i):this.logger.error(`Consent '${n}' could not be logged to tracker. 'mtr_consent' is not defined`)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Tracker=(class{constructor(n,t){this.logger=n;this.windowProvider=t;this.window=this.windowProvider.get()}getUid(){const n=this.getTrackerInstance().getUid();if(n)return+n}goal(n,t,i){this.getTrackerInstance().goal(n,i,t)}log(n,t,i,r){this.logToTracker(()=>{this.getTrackerInstance().log(n,t,i,r)})}logEvent(n){this.logToTracker(()=>{this.getTrackerInstance().logEvent(n)})}widget(n,t,r,u){this.logToTracker(()=>{const o=this.getTrackerInstance();o.widget(n,t,u);const f=this.getPerson();f.campaignEvents||(f.campaignEvents=[]);const e=new i;if(e.campaignId=r,e.time=new Date,e.type=n,f.campaignEvents.push(e),f.campaignEvents.length>10){const n=[];f.campaignEvents.reduce((n,t)=>n.set(t.campaignId+"-"+t.type,[...n.get(t.campaignId+"-"+t.type)||[],t]),new Map).forEach(t=>{n.push(...t.slice(-10))});f.campaignEvents=n}o.setPerson(f)})}getVisit(){const n=this.getTrackerInstance();if(n)return n.getVisit()}getPerson(){const t=this.getTrackerInstance();let n;return t&&(n=t.getPerson()),n?(n.goals||(n.goals=[]),n.tags||(n.tags=[])):(this.logger.warn("Person not found from Tracker-storage. Creating new instance"),n={tags:[],goals:[]}),n}setPerson(n){const t=this.getTrackerInstance();t&&t.setPerson(n)}setVisit(n){const t=this.getTrackerInstance();t&&t.setVisit(n)}isTrackerInitialized(){return void 0!==window.mtr}getTrackerInstance(){const n=window.mtr;return this.isTrackerInitialized()||this.logger.debug("Tracker is not initialized"),n}logToTracker(n){void 0===this.getTrackerInstance()?(this.logger.debug("Tracker not initialized yet, adding event listener and logging in callback"),document.addEventListener&&document.addEventListener("afterTriggerbeeReady",function(){n()})):n()}});n.TrackerMock=(class{constructor(n,t){this.uid=n;this.identifier=t;this.loggedGoals=[];this.loggedWidgetEvents=[]}getUid(){return this.uid||-1}log(){}logEvent(n){"goal"===n.type&&this.loggedGoals.push(n.name);n.callback&&n.callback()}goal(n,t){this.loggedGoals.push(n);t&&t()}widget(n,t,i,r){this.loggedWidgetEvents.push({eventName:n,widgetId:t});r&&r()}getVisit(){return null}getPerson(){if(this.identifier){const n=new t;return n.identifier=this.identifier,n}return null}setPerson(){}setVisit(){}isTrackerInitialized(){return!0}});n.Visit=(class{});class t{}n.Person=t;class i{}n.PersonCampaignEvent=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.VisitorStateService=(class{constructor(n,t,i){this.logger=n;this.utilities=t;this.widgetUtilities=i}getCookieName(){return`triggerbee_widgets_state_${this.widgetUtilities.getCurrentSiteId()}`}getCurrentState(){const n=this.utilities.getCookie(this.getCookieName())||"{}";return JSON.parse(n)}setCurrentState(n){const t=JSON.stringify(n),i=this.utilities.setSlidingCookie(this.getCookieName(),t,15);this.logger.debug(i)}increasePageViews(){const n=this.getCurrentState();n.pageviews||(n.pageviews=0);n.pageviews=n.pageviews+1;this.setCurrentState(n)}hasPartialSubmit(n,t){var i;const r=null===(i=this.getCurrentState().partialSubmits)||void 0===i?void 0:i.find(t=>this.containsPartialSubmit(n,t));return!(!r||JSON.stringify(r.formData)!==JSON.stringify(t.formData))}addPartialSubmit(n,t){const i=this.getCurrentState();i.partialSubmits||(i.partialSubmits=[]);i.partialSubmits=i.partialSubmits.filter(t=>!this.containsPartialSubmit(n,t));i.partialSubmits.push(t);this.setCurrentState(i)}containsPartialSubmit(n,t){return t.widgetId==n.id&&t.responseListId==n.responseListId}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetContainersService=(class{constructor(n){this.utilities=n;this.timers={};this.animations={}}initialize(n,t){this.shadowRoot=t;this.widget=n;this.addContainerAnimations()}widgetStateSwitched(){for(let n of Object.keys(this.timers))clearTimeout(this.timers[Number(n)]);for(let n of Object.keys(this.animations))this.animations[Number(n)].cancel();this.addContainerAnimations()}shouldIncludeElement(n){return!(!n.classList.contains("component")&&!n.classList.contains("grouped-component-wrapper"))&&(this.utilities.isMobile()?!n.classList.contains("hide-on-mobile"):!n.classList.contains("hide-on-desktop"))}addContainerAnimations(){const t=this.widget.states&&this.widget.states.find(n=>!this.shadowRoot.querySelector(`[data-position-id="${n.id}"`).classList.contains("hidden"));t&&(t.containers&&t.containers.filter(n=>n.visualEffect)).forEach(t=>{const i=this.shadowRoot.querySelector(`[data-container-id="${t.id}"`);if(t.visualEffect.repeat){const n=[...i.children].find(n=>this.shouldIncludeElement(n));n&&this.addRepeatedComponents(t.visualEffect,i,n)}const r=[...i.children].filter(n=>this.shouldIncludeElement(n));let u=0;for(let i of r)t.visualEffect.effect!=n.ContainerEffectType.Marquee?i.classList.add("hidden-component"):(i.classList.add("marquee-component"),i.classList.add("invisible-component")),i.clientHeight>u&&(u=i.clientHeight);const f=document.createElement("div");f.style.minHeight=`${u}px`;i.appendChild(f);i.classList.add("animating");t.visualEffect.effect==n.ContainerEffectType.SlideIn?this.addSlideInAnimation(i,r,t):t.visualEffect.effect==n.ContainerEffectType.Marquee&&setTimeout(()=>{this.addMarqueeAnimation(i,r,t)},500)})}addRepeatedComponents(t,i,r){const f=r.children[0];let u;if(t.direction==n.RelativeDirection.Left||t.direction==n.RelativeDirection.Right){r.style.width="max-content";const n=f.clientWidth,t=i.clientWidth;u=Math.ceil(t/n)}else{const n=f.clientHeight,t=i.clientHeight;u=Math.ceil(t/n)}const e=r.outerHTML;if(isFinite(u)){const n=e.repeat(u+1);r.parentElement.innerHTML+=n}}addSlideInAnimation(n,t,i){let r,f,e,u=t.length-1;const o=i.visualEffect,s=()=>{f&&f.cancel();t[u].classList.add("hidden-component");u=(u+1)%t.length;r=t[u];r.classList.remove("hidden-component");const h=this.createSlideKeyframes(o,n,r);r.animate(h.in,{duration:200,easing:"ease-out"});e=setTimeout(()=>{f=r.animate(h.out,{duration:200,easing:"ease-in",fill:"forwards"}),setTimeout(s,200)},1e3*o.animationDuration);this.timers[i.id]=e};s()}createSlideKeyframes(t,i,r){const e=t.direction==n.RelativeDirection.Left||t.direction==n.RelativeDirection.Right,o=e?"translateX":"translateY",s=t.direction==n.RelativeDirection.Down||t.direction==n.RelativeDirection.Right?-1:1;let u=i.clientWidth,f=u;return e||(t.direction==n.RelativeDirection.Down?(u=r.getBoundingClientRect().bottom-i.getBoundingClientRect().top,f=i.getBoundingClientRect().bottom-r.getBoundingClientRect().top):(u=i.getBoundingClientRect().bottom-r.getBoundingClientRect().top,f=r.getBoundingClientRect().bottom-i.getBoundingClientRect().top)),{"in":[{transform:`${o}(${s*u}px)`},{transform:"translate(0)"}],out:[{transform:`${o}(${-s*f}px)`}]}}addMarqueeAnimation(t,i,r){const u=r.visualEffect,s=u.direction==n.RelativeDirection.Left||u.direction==n.RelativeDirection.Right,o=i.length-1,h=s?t.clientWidth:t.clientHeight,f=new Array(i.length),l=new Array(i.length),e=new Array(i.length);let a=0,c=h,v=this.oppositeDirection(u.direction);t.classList.add("marquee");for(let n=0;n<f.length;n++){e[n]=i[n].children[0];!u.wrapText&&s&&i[n].querySelector(".text-content")&&(i[n].style.width="max-content");const r=e[n].clientHeight;f[n]=s?e[n].clientWidth:r;l[n]=s?this.componentPosition(e[n],t).left:this.componentPosition(e[n],t).top;i[n].classList.remove("invisible-component")}for(let n=0;n<f.length;n++){let t=0;for(let i=0;i<o;i++)t+=f[(n+i)%f.length];t<c&&(c=t)}o>0&&!u.repeat&&(a=(h-c)/o);const y=this.calculateStartPosition(u.direction,h,!0);for(let n=0;n<f.length;n++){const i=s=>{const p=(n+o)%f.length,c={edge:s};(n>0||isNaN(s))&&o>0&&(c.element=this.componentPosition(e[p],t)[v]);const h=""+r.id+n;this.animations[h]=this.createMarqueeAnimation(u,e[n],c,t,l[n],f[n],a);this.animations[h]&&(this.animations[h].onfinish=()=>{0==o?i(y):i()})},s=0==n?this.calculateStartPosition(u.startPosition,h):this.componentPosition(e[n-1],t)[v];i(s)}}createMarqueeAnimation(t,i,r,u,f,e,o){const c=t.direction==n.RelativeDirection.Left||t.direction==n.RelativeDirection.Right,s=t.direction==n.RelativeDirection.Left||t.direction==n.RelativeDirection.Up?1:-1,l=c?"translateX":"translateY",y=c?u.clientWidth:u.clientHeight;let h;h=r.element?r.element+s*o-f+(s<0?-e:0):r.edge-f+(s<0?-e:0);const a=(s<0?y:-e)-f,p=[{transform:`${l}(${h}px)`},{transform:`${l}(${a}px)`}],v=Math.abs(h-a)/t.animationDuration*10;if(!isNaN(v))return i.animate(p,{duration:v})}componentPosition(n,t){const i=t.getBoundingClientRect(),r=n.getBoundingClientRect();return{top:r.top-i.top,bottom:r.bottom-i.top,left:r.left-i.left,right:r.right-i.left}}oppositeDirection(t){switch(t){case n.RelativeDirection.Left:return"right";case n.RelativeDirection.Right:return"left";case n.RelativeDirection.Up:return"bottom";default:return"top"}}calculateStartPosition(t,i,r){return r?t==n.RelativeDirection.Right||t==n.RelativeDirection.Down?0:t==n.RelativeDirection.Left||t==n.RelativeDirection.Up?i:void 0:t==n.AnimationStartPosition.Left||t==n.AnimationStartPosition.Top?0:t==n.AnimationStartPosition.Right||t==n.AnimationStartPosition.Bottom?i:i/2}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){!function(n){let t=class extends HTMLElement{constructor(){super()}connectedCallback(){}};t.selector="triggerbee-widget";t=i([n.CustomElement({selector:t.selector,template:"",style:"",useShadow:!0})],t);n.TriggerbeeWidgetElement=t}(n.WebComponents||(n.WebComponents={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetEventsService=(class{constructor(n,t){this.logger=n;this.utilities=t}triggerOnOpened(n){this.triggerEventBase("onTriggerbeeWidgetOpened",n)}triggerOnClosed(n){this.triggerEventBase("onTriggerbeeWidgetClosed",n)}triggerOnBeforeFormSubmission(n){this.triggerEventBase("onBeforeTriggerbeeFormSubmitted",n)}triggerOnAfterFormSubmission(n){this.triggerEventBase("onAfterTriggerbeeFormSubmitted",n)}triggerOnButtonClick(t,i){const r="onTriggerbeeWidgetButtonClicked";this.validate(r,t)&&this.triggerEvent(r,new n.WidgetButtonClickEvent(t,i))}triggerOnSwitchState(t,i){const r="onTriggerbeeWidgetStateSwitched";this.validate(r,t)&&this.triggerEvent(r,new n.WidgetSwitchStateEvent(t,i))}triggerOnWidgetMinimized(t,i){const r="onTriggerbeeWidgetMinimized";this.validate(r,t)&&this.triggerEvent(r,new n.WidgetMinimizedEvent(t,i))}triggerEventBase(t,i){this.validate(t,i)&&this.triggerEvent(t,new n.WidgetEvent(i))}triggerEvent(n,t){this.utilities.triggerEvent(n,t)}validate(n,t){return!!t||(this.logger.warn(`Could not trigger event '${n}' - No widget found`),!1)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetPreviewService=(class{isPreview(){return!!this.getWidgetPreviewParameterValue()}getWidgetPreviewParameterValue(){const n=this.getPreviewParameterValue("tb-widget-preview");return n||this.getTemplatePreviewParameterValue()}getTemplatePreviewParameterValue(){return this.getPreviewParameterValue("tb-template-preview")}getPreviewParameterValue(n){return new URLSearchParams(window.location.search).get(n)}getWidgetSharingData(){const i=new URLSearchParams(window.location.search),u=i.get("tb-widget-shared"),f=i.get("tb-trigger-shared"),r=i.get("tb-open");let t=new n.WidgetSharingData;return t.widgetId=u,t.triggerType=f,r&&(t.campaignId=+r),t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){var i;(function(i){class r{constructor(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){this.logger=n;this.windowProvider=t;this.widgetsCloseService=i;this.widgetConditionsService=r;this.repetitionCheckService=u;this.widgetSchedulingService=f;this.audienceChecker=e;this.widgetEventsService=o;this.widgetUtilities=s;this.productRecommendationsService=h;this.tracker=c;this.trackerService=l;this.httpClient=a;this.discountCodeService=v;this.deadlineComponentService=y;this.buttonListComponentService=p;this.widgetContainersServive=w;this.splitInputsToStepsService=b;this.visitorStateService=k;this.widgetPreviewService=d;this.formsService=g;this.widgetComponentsService=nt;this.missingEmbeddedElementCampaignIds=[];this.window=this.windowProvider.get();this.document=this.window.document;this.handleEmbeddedWidgetElementMissing();this.hiddenClass=s.hiddenClass}handleEmbeddedWidgetElementMissing(){this.document.addEventListener&&this.document.addEventListener("onTriggerbeeWidgetElementMissing",n=>t(this,void 0,void 0,function*(){const t=n.detail.widget;let i,r=0;if(this.missingEmbeddedElementCampaignIds.indexOf(t.campaignId)>-1)this.logger.debug(`Widget with campaign ID '${t.campaignId}' already have another missing-element event, canceling this one`);else{for(this.missingEmbeddedElementCampaignIds.push(t.campaignId);!i&&r<10;)this.logger.warn(`Campaign with ID '${t.campaignId}' expected element with selector '${t.placeholderSelector}' that was not found. Retry count: ${r}`),i=this.getAppendToElement(t),yield this.widgetUtilities.delay(200),r++;this.missingEmbeddedElementCampaignIds.splice(this.missingEmbeddedElementCampaignIds.findIndex(n=>n===t.campaignId),1);i?this.isWidgetWithCurrentCampaignAlreadyOpen(t)?this.logger.debug(`Element with campaign ID '${t.campaignId}' is already opened`):this.appendWidget(t,i):this.logger.warn(`Element with campaign ID '${t.campaignId}' was not found. Widget '${t.id}' will therefore not be opened`)}}))}openWidget(n){return t(this,void 0,void 0,function*(){const t=this.getAppendToElement(n);return t?this.appendWidget(n,t):(this.widgetEventsService.triggerEvent("onTriggerbeeWidgetElementMissing",{widget:n}),!1)})}appendWidget(r,u){return t(this,void 0,void 0,function*(){let t=document.createElement(n.Widgets.WebComponents.TriggerbeeWidgetElement.selector);t.setAttribute("data-id",r.id.toString());const f=yield this.getWidgetHtml(r);return this.isWidgetWithCurrentCampaignAlreadyOpen(r)?(this.logger.warn(`Element with campaign ID '${r.campaignId}' is already opened`),!1):f?(this.appendToWebsite(r,u,t),this.appendHtmlToTriggerbeeWidget(t,r,f),this.widgetEventsService.triggerOnOpened(r),this.trackerService.logWidgetOpened(r.id,r.campaignId),r.attributionType===i.AttributionType.Impression&&this.trackerService.logAttribution(r.id),this.logger.debug(`Opened widget '${r.id}'`),!0):!1})}getWidgetHtml(n){return t(this,void 0,void 0,function*(){const i=this.productRecommendationsService.getProductRecommendationProperties(n);if(i){const t=this.tracker.getPerson(),f=t?t.identifier:void 0;if(!(i.fallbackDataSetId||f||this.hasEmailProviderQueryString()||this.widgetPreviewService.isPreview()))return void this.logger.debug(`No data set fallback found and no identifier for visitor '${this.tracker.getUid()}'. Widget '${n.id}'`);const r=[];if("undefined"!=typeof findProductId){const n=findProductId();n&&r.push(n)}const u=yield this.productRecommendationsService.getProductRecommendations(n,r);return u?u.widgetHtml:void this.logger.error(`No response found using product recommendations for widget: '${n.id}'`)}{const i=this.widgetUtilities.getWidgetHtmlUrl(n.id,this.widgetPreviewService.isPreview());var t=yield this.httpClient.getHtmlAsync(i);return t&&200==t.statusCode?t.data:void this.logger.error(`Could not get HTML for widget: '${n.id}'. StatusCode: ${t.statusCode}`)}})}hasEmailProviderQueryString(){const n=this.tracker.getVisit();if(n&&n.landingPageQueryParams){const i=window.triggerbee.widgets.emailProviderQueryStrings;for(var t=0;t<i.length;t++)if(n.landingPageQueryParams.some(n=>0===n.indexOf(i[t])))return!0}return!1}appendToWebsite(n,t,r){if(n.placeholderEmbedMethod)switch(n.placeholderEmbedMethod){case i.EmbedMethod.Replace:t.parentNode.replaceChild(r,t);break;case i.EmbedMethod.AppendChild:t.appendChild(r);break;case i.EmbedMethod.AppendChildFirst:t.insertAdjacentElement("afterbegin",r);break;case i.EmbedMethod.AppendSiblingBefore:t.previousElementSibling?t.previousElementSibling.insertAdjacentElement("afterend",r):t.parentElement.insertAdjacentElement("afterbegin",r);break;case i.EmbedMethod.AppendSiblingAfter:t.parentNode.insertBefore(r,t.nextSibling)}else t.appendChild(r)}getAppendToElement(n){return n.isEmbedded?n.placeholderSelector?this.document.querySelector(n.placeholderSelector):this.document.getElementById(`triggerbee-campaign-${n.campaignId}`):this.document.body}shouldOpenWidget(n){return t(this,void 0,void 0,function*(){return this.isWidgetWithCurrentCampaignAlreadyOpen(n)?(this.logger.debug(`A widget with campaign ID '${n.campaignId}' is already opened and widget '${n.id}' will therefore not be opened`),!1):this.widgetSchedulingService.checkConditions(n)?this.widgetsCloseService.isAnyClosed(n.id)&&!this.repetitionCheckService.checkRepetitions(n)?!1:n.conditionsAndAudienceOperation==i.ConditionsAndAudienceOperation.And?this.widgetConditionsService.checkConditions(n)&&(!n.audienceId||(yield this.audienceChecker.checkAsync(n))):this.widgetConditionsService.checkConditions(n)||!n.audienceId||(yield this.audienceChecker.checkAsync(n)):!1})}isWidgetWithCurrentCampaignAlreadyOpen(n){const r=this.widgetUtilities.getConfiguredWidgets(),i=this.getAllOpenWidgets();for(var t=0;t<i.length;t++){const u=r.find(n=>n.id.toString()===i[t].getAttribute("data-id"));if(u||this.logger.warn(`Widget with ID '${n.id}' was found as HTML-element but not in configuration`),n.campaignId===u.campaignId)return!0}return!1}closeWidget(n){return t(this,void 0,void 0,function*(){const t=this.widgetUtilities.getWidgetbyId(n);this.playExitAnimation(n,t);const i=t.transition&&t.transition.exitAnimation?1e3*(t.transition.animationDuration||0)-20:0;i>0&&(yield this.widgetUtilities.delay(i));const r=this.removeWidgetHtml(n);return r&&this.widgetEventsService.triggerOnClosed(this.widgetUtilities.getWidgetbyId(n)),r})}removeWidgetHtml(n){const t=this.widgetUtilities.getWidgetElementById(n);return t?(t.remove(),!0):(this.logger.warn(`No widget found by ID: "${n}"`),!1)}getAllOpenWidgets(){return this.document.querySelectorAll(`${n.Widgets.WebComponents.TriggerbeeWidgetElement.selector}`)}playExitAnimation(n,t){const i=this.widgetUtilities.getWidgetElementById(n);if(i&&t.transition&&t.transition.exitAnimation){const u=i.shadowRoot,f=t.states?t.states.find(n=>!u.querySelector(`[data-position-id="${n.id}"`).classList.contains(this.hiddenClass)):null,n=u.querySelector(`[data-state="${f.id}"]`),r=this.getAnimationClass(t.transition);n.style.cssText+=`animation-duration: ${t.transition.animationDuration||.5}s`;r.entryClass&&n.classList.remove(r.entryClass);n.classList.add(r.exitClass)}}appendEntryAnimation(n,t){if(t&&t.transition&&t.transition.entryAnimation){const i=1e3*t.transition.animationDuration||1e3;this.window.addEventListener("onTriggerbeeWidgetOpened",r=>{const f=this.getAnimationClass(t.transition);if(r.detail.id==t.id&&f.entryClass){const o=t.states?t.states.find(t=>!n.querySelector(`[data-position-id="${t.id}"`).classList.contains(this.hiddenClass)):null,u=n.querySelector(`[data-state="${o.id}"]`),e=`animation-duration: ${t.transition.animationDuration||.5}s`;u.style.cssText+=e;u.classList.add(f.entryClass);setTimeout(()=>{u.style.cssText.replace(e,""),u.classList.remove(f.entryClass)},i)}})}}getAnimationClass(n){const t=n.isElastic||n.entryAnimation==i.EntryAnimationType.ToneIn||n.entryAnimation==i.EntryAnimationType.WiggleIn?"":"-smooth",r=n.isElastic||n.exitAnimation==i.ExitAnimationType.ToneOut?"":"-smooth";return{entryClass:n.entryAnimation?n.entryAnimation.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+t:"",exitClass:n.exitAnimation?n.exitAnimation.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+r:""}}isAnyOverlayAlreadyOpened(n,t,i){let r=!1;return n.isEmbedded||i.forEach(n=>{t.find(t=>t.campaignId===n).isEmbedded||(r=!0)}),r}prefillFromQueryParameter(n){const i=new URLSearchParams(window.location.search),r=/\[(.*?)\]/,u=i.keys();for(var t of u)if(t.startsWith("tb-prefill")){const u=t.match(r),e=u?u[1]:"",o=i.get(t);let f=n.shadowRoot.querySelector(`input[name="${e}"]`);null!==f&&(f.value=o)}}appendHtmlToTriggerbeeWidget(n,t,i){const r=this.document.createElement("div");r.innerHTML=i;n.shadowRoot.appendChild(r);this.prefillFromQueryParameter(n);this.addConsentCheckboxEvents(n.shadowRoot);this.preventTriggerStateActionOnChildrenClick(n.shadowRoot);this.discountCodeService.addDiscountCodeEvents(n);this.deadlineComponentService.startCounting(t,n.shadowRoot);this.buttonListComponentService.initialize(t,n.shadowRoot);this.widgetContainersServive.initialize(t,n.shadowRoot);this.widgetComponentsService.initialize(t,n.shadowRoot);this.addTimeoutToButtons(n.shadowRoot,t);this.appendEntryAnimation(n.shadowRoot,t);this.handleMultiStepFormEvents(n.shadowRoot,t);this.splitInputsToStepsService.handleSlidingFormToSplitInputsToSteps(n.shadowRoot,t);this.saveClientHeight(n.shadowRoot,t);this.handleSingleUseDiscountComponent(t,n.shadowRoot);let u=r.getElementsByTagName("script");for(let n=0;n<u.length;n++)eval(u[n].innerHTML);this.widgetPreviewService.isPreview()||this.checkIfSavedStateExists(n,t)}handleSingleUseDiscountComponent(n,t){var i;null===(i=n.states)||void 0===i||i.forEach(i=>{t.querySelector(`[data-position-id="${i.id}"`).classList.contains(this.hiddenClass)||this.discountCodeService.handleAllSingleUseDiscountComponents(n,i,t)})}handleMultiStepFormEvents(n,t){if(t.formType===i.WidgetFormType.MultiStep){const r=n.querySelector("form");r&&(n.querySelectorAll(".state").forEach(n=>{this.formsService.getFormFields(n,"input").length>0&&n.addEventListener("keypress",r=>{if("Enter"===r.key&&r.target instanceof HTMLInputElement&&this.formsService.validateFormFieldsInState(n)){const r=n.querySelector(".component-buttonsubmit button");if(r)r.click();else{const r=[...n.querySelectorAll(`button[data-action="${i.WidgetComponentButtonAction.SwitchState}"],button[data-action="${i.WidgetComponentButtonAction.SwitchStateNext}"]`)];if(1===r.length)r[0].click();else{const n=r.filter(n=>n.getAttribute("data-action")==i.WidgetComponentButtonAction.SwitchStateNext)[0];n?n.click():this.logger.warn(`More than 1 button found on current state in widget: ${t.id}`)}}}})}),r.addEventListener("keypress",n=>{"Enter"===n.key&&n.preventDefault()}))}}addTimeoutToButtons(n,t){this.window&&(!this.window||this.window.addEventListener)&&(this.window.addEventListener("onTriggerbeeWidgetOpened",()=>{var r,u;let f;const i=null===(r=t.states)||void 0===r?void 0:r.find(t=>{const i=n.querySelector(`[data-position-id="${t.id}"`);return!i.classList.contains(this.hiddenClass)&&(f=i,!0)});i.actionTriggerDelay&&setTimeout(()=>{const t=n.querySelector(`[data-state="${i.id}"]`);t?t.click():this.logger.warn(`Could not find state HTML element by ID: '${i.id}`)},1e3*i.actionTriggerDelay);null===(u=null==i?void 0:i.containers)||void 0===u||u.forEach(t=>{var i;null===(i=t.components)||void 0===i||i.forEach(t=>{this.checkAndTriggerAutoClick(n,f,t)})})}),this.window.addEventListener("onTriggerbeeWidgetStateSwitched",i=>{var u,f;const r=null===(u=t.states)||void 0===u?void 0:u.find(n=>n.id==i.detail.stateId),e=r?n.querySelector(`[data-position-id="${r.id}"`):null;null===(f=null==r?void 0:r.containers)||void 0===f||f.forEach(t=>{var i;null===(i=t.components)||void 0===i||i.forEach(t=>{this.checkAndTriggerAutoClick(n,e,t)})})}))}checkAndTriggerAutoClick(n,t,i){if(i&&i.actionTriggerDelay){const r=n.querySelector(`[data-component="${i.id}"`),u=r.querySelector(".actual-element"),f=t&&t.classList.contains(this.hiddenClass),e=r.classList.contains(this.hiddenClass);f||e||setTimeout(()=>{u.click()},1e3*i.actionTriggerDelay)}}saveClientHeight(n,t){this.window&&(!this.window||this.window.addEventListener)&&this.window.addEventListener("onTriggerbeeWidgetOpened",i=>{var u;if(i.detail.id==t.id){let r;null===(u=t.states)||void 0===u||u.find(t=>{const i=n.querySelector(`[data-state="${t.id}"`);return i.parentElement.classList.value,!i.classList.contains(this.hiddenClass)&&i.clientHeight>0&&(r=i,!0)});r&&(r.setAttribute("data-height",r.clientHeight.toString()),r.setAttribute("data-width",r.clientWidth.toString()))}})}checkIfSavedStateExists(n,t){const r=this.visitorStateService.getCurrentState(),u=r?r.widgets:void 0,f=u?u.find(n=>n.id===t.id):void 0,i=f?f.currentStateId:void 0;if(i){const t=n.shadowRoot.querySelectorAll(".position"),r=n.shadowRoot.querySelector(`[data-position-id="${i}"]`);t.forEach(n=>n.classList.add(this.hiddenClass));this.addModalBackground(n.shadowRoot,i);r.classList.remove(this.hiddenClass)}}addModalBackground(n,t){const i=n.querySelector(".layout-popup");if(i){const r=n.querySelector(".state-teaser");r&&r.getAttribute("data-state")===t.toString()?i.classList.remove("modal"):i.classList.add("modal")}}addConsentCheckboxEvents(n){const t=n.querySelector("#triggerbee-consent-container");if(t){const n=t.querySelector(".consent-checkbox"),i=this;n.addEventListener("invalid",function(){i.toggleConsentCheckboxInvalid(n,!0)});n.addEventListener("change",function(){i.toggleConsentCheckboxInvalid(n,!this.checked)})}}toggleConsentCheckboxInvalid(n,t){const i="invalid";t?n.classList.contains(i)||n.classList.add(i):n.classList.remove(i)}preventTriggerStateActionOnChildrenClick(n){n.querySelectorAll("a, input, button").forEach(n=>{n.addEventListener("click",function(n){n.stopPropagation()})})}}i.WidgetService=r})(i=n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetStatesService=(class{constructor(n,t,i,r,u,f,e,o,s){this.logger=n;this.widgetService=t;this.widgetUtilities=i;this.widgetPreviewService=r;this.widgetEventsService=u;this.visitorStateService=f;this.formsService=e;this.widgetContainersService=o;this.discountCodeService=s}isCurrentStateFormValid(n){let t=!0;if(n){const i=n.closest(".state");t=this.formsService.validateFormFieldsInState(i)}else this.logger.warn("No element provided to validate state form");return t}switchState(n,t){this.switchStateTemplateMethod(n,t,n=>{this.widgetEventsService.triggerOnSwitchState(n,t),this.widgetContainersService.widgetStateSwitched()})}validateAndSwitchStateNext(n,t){const i=this.getStateElements(t),r=i[this.getCurrentStateIndex(i,n)+1];if(r){if(this.isCurrentStateFormValid(n))return this.switchState(t,this.getStateId(r)),!0}else this.logger.warn("Could not find any state after current");return!1}switchStatePrevious(n,t){const i=this.getStateElements(t),r=i[this.getCurrentStateIndex(i,n)-1];r?this.switchState(t,this.getStateId(r)):this.logger.warn("Could not find any state before current")}switchStateTemplateMethod(n,t,i){if(-1!==t){const r=this.widgetUtilities.getWidgetElementById(n);if(r){const f=r.shadowRoot,u=f.querySelector(`[data-state="${t}"]`);if(u){let r;f.querySelectorAll(".state").forEach(n=>{n.parentElement.classList.add("hidden"),n.hasAttribute("data-height")&&(r=n)});const o=this.getLayoutFromClasslistByPrefix(u.parentElement.classList,"state-layout-"),s=this.getLayoutFromClasslistByPrefix(f.querySelector(".layout").classList,"layout-");if(o!==s){const n=f.querySelector(".layout");n.classList.remove("layout-"+s);n.classList.add("layout-"+o)}this.widgetService.addModalBackground(f,t);u.parentElement.classList.remove("hidden");const e=this.widgetUtilities.getWidgetbyId(n);if(u.setAttribute("data-height",u.clientHeight.toString()),u.setAttribute("data-width",u.clientWidth.toString()),r){const n=r.parentElement.classList.value,t=u.parentElement.classList.value,i=n.includes("right")||n.includes("left"),o=n.includes("center");(i&&t.includes("center")||o&&(t.includes("left")||t.includes("right"))||e.transition&&e.transition.morphBetweenStates)&&u.animate(this.getPreviousStateKeyframes(u,r,f),{duration:150,easing:"cubic-bezier(.17,.84,.44,1)"});r.removeAttribute("data-height");r.removeAttribute("data-width")}this.widgetPreviewService.isPreview()||this.updateCurrentState(n,t);const h=e.states.find(n=>+n.id==+t);this.discountCodeService.handleAllSingleUseDiscountComponents(e,h,f);i(e)}else this.logger.warn(`No state found by ID: "${t}"`)}}}getPreviousStateKeyframes(n,t,i){const r=Number(t.getAttribute("data-height")),u=Number(t.getAttribute("data-width")),o=u/n.clientWidth,s=r/n.clientHeight,f=this.calculateStateElementCenter(n.parentElement,i,n.clientWidth,n.clientHeight),e=this.calculateStateElementCenter(t.parentElement,i,u,r);return[{transform:`translate(${e.x-f.x}px, ${e.y-f.y}px) scale(${o}, ${s})`},{transform:"translate(0) scale(1, 1)"}]}calculateStateElementCenter(n,t,i,r){const f=t.querySelector(".layout"),u=this.getStateRelativePosition(n.classList),e=(0==u.x?.5:1==u.x?-.5:0)*i,o=0==u.y?.5:(1==u.y?-.5:0)*r;return{x:u.x*f.clientWidth+e,y:u.y*f.clientHeight+o}}getStateRelativePosition(n){return n.contains("position-topright")?{x:1,y:0}:n.contains("position-topleft")?{x:0,y:0}:n.contains("position-bottomleft")?{x:0,y:1}:n.contains("position-bottomright")?{x:1,y:1}:n.contains("position-bottom")?{x:.5,y:1}:n.contains("position-top")?{x:.5,y:0}:{x:.5,y:.5}}getLayoutFromClasslistByPrefix(n,t){let i;return n.forEach(n=>{-1!==n.indexOf(t)&&(i=n.substring(t.length))}),i}updateCurrentState(n,t){const i=this.visitorStateService.getCurrentState();i.widgets=i.widgets||[];const r=i.widgets.find(t=>t.id===n);r?r.currentStateId=t:i.widgets.push({id:n,currentStateId:t});this.visitorStateService.setCurrentState(i)}getCurrentStateElement(n,t){if(t){const i=this.getCurrentStateId(t);if(i)return this.getStateElements(n).find(n=>n.getAttribute("data-state")===i)}}getStateElements(n){return[...this.widgetUtilities.getWidgetElementById(n).shadowRoot.querySelectorAll("[data-state]")]}getCurrentStateId(n){return n.closest(".state").getAttribute("data-state")}getCurrentStateIndex(n,t){return n.findIndex(n=>n.getAttribute("data-state")==this.getCurrentStateId(t))}getStateId(n){return n.getAttribute("data-state")}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.WidgetUtilities=(class{constructor(n,t){this.logger=n;this.hiddenClass="hidden";this.window=t.get();this.resourcesUrl=this.window.triggerbee.widgets.resourcesUrl}getConfiguredWidgets(){return this.window.triggerbee.widgets.configurations}configureWidgets(n){this.window.triggerbee.widgets.configurations=n}getWidgetbyId(n){const t=this.getConfiguredWidgets().find(t=>t.id==n);return t||this.logger.warn(`No widget found by ID: "${n}"`),t}getWidgetElementById(t){const i=this.window.document.querySelector(`${n.Widgets.WebComponents.TriggerbeeWidgetElement.selector}[data-id="${t}"]`);return i||this.logger.warn(`No widget found by ID: "${t}"`),i}isEmbedded(n){const t=this.getWidgetbyId(n);return t&&t.isEmbedded}getSpinner(n){for(var t=n.childNodes.length-1;t>=0;t--)n.removeChild(n.childNodes[t]);return n.innerHTML='<svg class="spinner" viewBox = "0 0 50 50" ><circle class="path" cx = "25" cy = "25" r = "20" fill = "none" stroke - width="5" > <\/circle>< /svg>',n.style.backgroundColor=n.style.backgroundColor.split(")")[0]+", .4)",n}delay(n){return new Promise(t=>{const i=setTimeout(()=>{t(i)},n)})}copyText(n,t){const i="visible";if(n)return n.classList.add(i),navigator.clipboard?navigator.clipboard.writeText(t.innerText):this.logger.warn("Copying requires HTTPS and not localhost"),setTimeout(function(){n.classList.remove(i)},1500)}getCurrentSiteId(){const n=this.window.triggerbee.siteId;if(n)return+n}getWidgetHtmlUrl(n,t){const r=t?"?v="+Math.floor(999*Math.random()):"";let i=`${this.resourcesUrl}/content/${this.getCurrentSiteId()}/${n}`;return t&&(i+="-preview"),`${i}.html${r}`}getWidgetJsonUrl(n,t){const r=t?"?v="+Math.floor(999*Math.random()):"";let i=`${this.resourcesUrl}/entities/${this.getCurrentSiteId()}/${n}`;return t&&(i+="-preview"),`${i}.json${r}`}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetsCloseService=(class{constructor(n,t,i,r,u){this.logger=n;this.utilities=t;this.widgetPreviewService=i;this.visitorStateService=r;this.widgetUtilities=u;this.cookieNameOld="triggerbee_widgets_closed";this.oneYearInHours=8760}getCookieName(){return`triggerbee_widgets_closed_${this.widgetUtilities.getCurrentSiteId()}`}markAsClosed(t,i){if(this.widgetPreviewService.isPreview())this.logger.debug(`Widget '${t}' NOT marked as closed because this is preview`);else{let r=this.getClosedWidgets(),u=r.filter(n=>n.id==t)[0];if(u){let n=r.findIndex(n=>n.id==t);r.splice(n,1)}else{let r=this.visitorStateService.getCurrentState();u=new n.WidgetClosed(t,i,r.pageviews)}let f=new Date;f.setFullYear(f.getFullYear()+1);u.expires=this.utilities.toUnix(f);r.push(u);this.setClosedCookie(r)}}cancelClosing(n){let t=this.getClosedWidgets();if(t.find(t=>t.id==n)){let i=t.findIndex(t=>t.id==n);return t.splice(i,1),this.setClosedCookie(t),!0}return!1}isClosed(n){let t=this.getClosedWidgetData(n);return!!t&&!!this.isWidgetClosed(t)&&(this.logger.debug(`Widget '${n}' is closed and will therefore NOT be shown`),!0)}isAnyClosed(n){let t=this.getClosedWidgetsByCampaign(n);if(0===t.length)return!1;let i=!1;for(let r of t)this.isWidgetClosed(r)&&(this.logger.debug(`Widget '${r.id}' is closed and therefore widget '${n}' will NOT be shown`),i=!0);return i}isWidgetClosed(n){return n.expires>this.utilities.toUnix(new Date)}getClosedWidgetData(n){return this.getClosedWidgets().find(t=>t.id==n)}getClosedWidgetsByCampaign(n){let i=this.getClosedWidgets();const t=this.widgetUtilities.getWidgetbyId(n);return t?i.filter(n=>this.isExpectedCampaignId(n,t)):(this.logger.error(`No widget found by ID '${n}'`),null)}isExpectedCampaignId(n,t){let i=!1;const r=this.widgetUtilities.getWidgetbyId(n.id);return r&&r.campaignId==t.campaignId&&(i=!0),i}getClosedWidgets(){let n=JSON.parse(this.utilities.getCookie(this.getCookieName())||"[]");return n.length>0||(n=JSON.parse(this.utilities.getCookie(this.cookieNameOld)||"[]"),n.length>0&&(this.setClosedCookie(n),this.utilities.setCookie(this.cookieNameOld,"",1))),n}setClosedCookie(n){const t=this.utilities.setCookie(this.getCookieName(),JSON.stringify(n),this.oneYearInHours);this.logger.debug(t)}removeExpiredWidgets(){const n=this.getClosedWidgets();if(n.length>0){let i=!1;const r=this.utilities.toUnix(new Date);for(var t=0;t<n.length;t++){const u=n[t];if(r>u.expires){const r=t;n.splice(r,1);i=!0;this.logger.debug(`Removing widget '${u.id}' from closed-cookie. Expire date '${u.expires}' is passed`)}}i&&(0===n.length?this.utilities.setCookie(this.getCookieName(),"",-1):this.setClosedCookie(n))}}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Utilities=(class{constructor(n,t){this.windowProvider=n;this.cookieProvider=t;this.debugCookieName="triggerbee_widgets_debug";this.getQueryStringValue=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let t=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))}}toDate(n){return new Date(n)}toUnix(n){return n.valueOf()}getCookie(n){return this.cookieProvider.get(n)}setCookie(n,t,i){return this.cookieProvider.set(n,t,i)}setSlidingCookie(n,t,i){return this.cookieProvider.setSliding(n,t,i)}isDebugMode(){return""!==this.cookieProvider.get(this.debugCookieName)}setDebugCookie(){try{this.getQueryStringValue("tb-debug")&&this.cookieProvider.set(this.debugCookieName,"_",8760)}catch(n){}}httpGet(n,t){let i=this.getXMLHttpRequest();i.open("GET",n,!0);i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t(i.responseText)};i.send()}copyToClipboard(n){const i=n.innerText,t=document.createElement("input");return t.value=i,n.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),n.removeChild(t),i}static isTestMode(){return!!window.__karma__}getXMLHttpRequest(){return XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")}triggerEvent(n,t){if(document.createEvent){let i=document.createEvent("Events");i.detail=t;i.initEvent(n,!0,!0);document.dispatchEvent(i)}}getClosestElement(n,t){return function t(i){if(!i||i===document||i===window)return null;let r=i.closest(n);return r||t(i.getRootNode().host)}(t)}isElementCurrentlyVisible(n){return!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)}isMobile(){return this.windowProvider.get().innerWidth<=767}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ExitIntentTrackerOptions=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ExitIntentTracker=(class{constructor(n,t){this.windowProvider=n;this.documentProvider=t;this.shown=0;this.disabled=!1;this.activated=!1;this.initialized=!1;this.options={distance:100,maxDisplay:1,method:"auto",sensitivity:10,cookieLife:365,scrollDelay:500,aggressive:!1,checkReferrer:!0,storeName:"triggerbee-exit-intent-tracker-visited",onBounce:[]};this.data={get:function(n,t){if(n.root.localStorage)return n.root.localStorage.getItem(t)||"";{const r=n.doc.cookie.split(";");let u=-1,i=[],f=r.length;for(;++u<f;)if(i=r[u].split("="),i[0]==t)return i.shift(),i.join("=");return""}},set:function(n,t,i){if(n.root.localStorage)n.root.localStorage.setItem(t,i);else{const r=new Date;r.setDate(r.getDate()+n.options.cookieLife);n.doc.cookie=t+"="+i+"; expires="+r.toUTCString()+";path=/;"}}};this.root=this.windowProvider.get();this.doc=this.documentProvider.get();this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(this.root.navigator.userAgent)}addOnBounce(n){if(!this.options||!this.initialized)throw new Error("Exit intent tracker is not initialized yet.");this.options.onBounce.push(n)}init(n){const t=this;if(n){for(let i in t.options)t.options.hasOwnProperty(i)&&!n.hasOwnProperty(i)&&(n[i]=t.options[i]);t.options=n}if(n.checkReferrer&&t.doc.referrer){const i=t.doc.createElement("a");i.href=t.doc.referrer;i.host==t.root.location.host&&t.data.set(t,n.storeName,"1")}t.activated||!n.aggressive&&t.data.get(t,n.storeName)||(t.activated=!0,"history"===n.method||"auto"===n.method&&t.isMobile?t.activate("history"):t.activate("mouse"),t.data.set(t,n.storeName,"1"));this.initialized=!0}enable(){this.disabled=!1;this.activated=!1;this.shown=0}disable(){this.disabled=!0;this.activated=!1}activate(n){let t=this;if("history"==n){"replaceState"in t.root.history?(t.root.history.replaceState({isBouncing:!0},t.root.title),t.root.history.pushState(null,t.root.title),t.addEvent(t.root,"popstate",function(){t.root.history.state&&t.root.history.state.isBouncing&&t.onBounce(t)})):"onhashchange"in t.root&&t.root.location.replace("#bht");t.root.location.hash="";t.addEvent(t.root,"hashchange",function(){"bht"===t.root.location.hash.substr(-3)&&t.onBounce(t)});let n=0;t.addEvent(t.root,"touchmove",function(){let i=t.root.pageYOffset||t.doc.documentElement.scrollTop;i<n&&t.onBounce(t);n=i<=0?0:i})}else{let i=null,n=[];t.addEvent(t.doc,"mousemove",function(t){n.unshift({x:t.clientX,y:t.clientY});n=n.slice(0,10)});t.addEvent(t.doc,"mouseout",function(i){if(!t.disabled){const r=i.relatedTarget||i.toElement;(!r||"HTML"==r.nodeName)&&i.clientY<=t.options.distance&&10==n.length&&n[0].y<n[9].y&&n[9].y-n[0].y>t.options.sensitivity&&t.onBounce(t)}});t.addEvent(t.doc,"keydown",function(n){n.stopPropagation();(n.ctrlKey&&("e"==n.key||"k"==n.key||"l"==n.key)||n.altKey&&"d"==n.key||"F6"==n.key)&&t.onBounce(t)});t.options.scrollDelay&&t.addEvent(t.root,"scroll",function(){t.disabled||(t.disabled=!0,clearTimeout(i),i=setTimeout(function(){t.disabled=!1},t.options.scrollDelay))})}}addEvent(n,t,i){n.attachEvent?n.attachEvent("on"+t,i):n.addEventListener(t,i,!1)}onBounce(n){if(n.shown++,!n.options.maxDisplay||n.shown<=n.options.maxDisplay)for(let n of this.options.onBounce)n()}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.WidgetDisplaySettingsService=(class{constructor(n,t,i,r,u){this.logger=n;this.visitorStateService=t;this.exitIntentTracker=i;this.widgetService=r;this.windowProvider=u;this.registeredEventWidgetOpeners=[];this.widgetOpeners=[];this.window=this.windowProvider.get()}configureWidgetOpeners(i){for(let r of i){let i=r.triggers;if(i&&0!==i.length){for(let u of i)if(!this.widgetOpeners.some(n=>n.widget.id==r.id&&u.type==n.trigger.type))switch(u.type){case n.Widgets.WidgetTriggerType.Instantly:this.widgetOpeners.push(new t.DefaultWidgetOpener(r,u));break;case n.Widgets.WidgetTriggerType.AfterXPageviews:this.widgetOpeners.push(new t.PageviewsWidgetOpener(this.logger,this.visitorStateService,r,u));break;case n.Widgets.WidgetTriggerType.AfterXSeconds:{const n=new t.DelayedBySecondsWidgetOpener(r,u);this.widgetOpeners.push(n);this.registeredEventWidgetOpeners.push(n);break}case n.Widgets.WidgetTriggerType.ExitIntent:{const n=new t.OnExitIntentWidgetOpener(r,u,this.exitIntentTracker);this.widgetOpeners.push(n);this.registeredEventWidgetOpeners.push(n);break}case n.Widgets.WidgetTriggerType.Scroll:{const n=new t.OnScrollWidgetOpener(r,u);this.widgetOpeners.push(n);this.registeredEventWidgetOpeners.push(n);break}case n.Widgets.WidgetTriggerType.InactiveForXSeconds:{const n=new t.InactiveForXSecondsOpener(r,this.widgetService,u);this.widgetOpeners.push(n);this.registeredEventWidgetOpeners.push(n);break}case n.Widgets.WidgetTriggerType.Manual:this.widgetOpeners.push(new t.ManualWidgetOpener(r,u))}}else this.logger.warn(`Widget '${r.id}': No trigger found`)}}getWidgetOpeners(n){return this.widgetOpeners.filter(t=>t.widget.id===n.id)}checkUrlSettings(n){if(!n.urlSettings)return!0;const t=this.removeEventualTrailingSlash(this.window.location.pathname).toLowerCase();return n.urlSettings.excludePaths&&n.urlSettings.excludePaths.length>0&&this.isPathMatchingAny(t,n.urlSettings.excludePaths)?(this.logger.debug(`Widget '${n.id}': Current path '${t}' equals some of the excluded paths '${n.urlSettings.excludePaths.toString()}'`),!1):!n.urlSettings.includePaths||0===n.urlSettings.includePaths.length?(this.logger.debug(`Widget '${n.id}': There were no includePaths so widget should be displayed`),!0):this.isPathMatchingAny(t,n.urlSettings.includePaths)?(this.logger.debug(`Widget '${n.id}': Current path '${t}' equals one of included paths '${n.urlSettings.includePaths.toString()}'`),!0):(this.logger.debug(`Widget '${n.id}': Current path '${t}' does NOT equal one of included paths '${n.urlSettings.includePaths.toString()}'`),!1)}removeRegisteredEventWidgetOpeners(n){this.registeredEventWidgetOpeners&&this.registeredEventWidgetOpeners.forEach(t=>{t&&t.widget.id===n&&t.reset()})}isPathMatchingAny(n,t){if(!t||0===t.length)throw new Error("Empty paths should be handled before");let i=!1;for(var r=0;r<t.length&&!i;r++){let u=this.removeEventualTrailingSlash(t[r]).toLowerCase();(n==u||this.pathMatchesWildcard(n,u))&&(i=!0)}return i}pathMatchesWildcard(n,t){return!(!t.endsWith("*")&&!t.startsWith("*"))&&(t.endsWith("*")&&t.startsWith("*")?(t=this.removeEventualTrailingCharacter("*",t),t=this.removeEventualStartingCharacter("*",t),n.includes(t)):t.startsWith("*")?(t=this.removeEventualStartingCharacter("*",t),n.endsWith(t)):(t=this.removeEventualTrailingCharacter("*",t),n.startsWith(t)))}removeEventualTrailingCharacter(n,t){return t.endsWith(n)&&(t=t.substring(0,t.length-1)),t}removeEventualStartingCharacter(n,t){return t.startsWith(n)&&(t=t.substring(1)),t}removeEventualTrailingSlash(n){return this.removeEventualTrailingCharacter("/",n)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetOpenerBase=(class{constructor(n,t){this.widget=n;this.trigger=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{onBeforeOpenAsync(n){return t(this,void 0,void 0,function*(){yield n()})}}n.DefaultWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.Dismissal="Dismissal";n.Conversion="Conversion";n.ClickThrough="ClickThrough"}(t=n.RepetitionType||(n.RepetitionType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.OpenUrl="OpenUrl";n.OpenUrlNewTab="OpenUrlNewTab";n.SwitchState="SwitchState";n.CloseWidget="CloseWidget";n.SubmitForm="SubmitForm";n.SwitchStateNext="SwitchStateNext";n.SwitchStatePrevious="SwitchStatePrevious"}(t=n.WidgetComponentButtonAction||(n.WidgetComponentButtonAction={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.EmptyLogger=(class{debug(){}info(){}warn(){}error(){}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ConsoleLogger=(class{debug(n){console.debug(n)}info(n){console.log(n)}warn(n){console.warn(n)}error(n){console.error(n)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.CookieProvider=(class{get(n){const t=document.cookie.split(";");for(let i=0,r=t.length;i<r;i++)if(t[i].match(new RegExp("\\b"+n+"=")))return decodeURIComponent(t[i].split(n+"=")[1]);return""}set(n,t,i){let r="";if(i){let n=new Date,t=n.getTime();t+=36e5*i;n.setTime(t);r="expires="+n.toUTCString()+";"}let u=n+"="+t+";"+r+"path=/;domain=."+location.hostname.replace(/^www\./i,"")+";";return document.cookie=u,u}setSliding(n,t,i){let u="";i||(i=15);let r=new Date;r.setMinutes(r.getMinutes()+i);u="expires="+r.toUTCString()+";";let f=n+"="+t+";"+u+"path=/;domain=."+location.hostname.replace(/^www\./i,"")+";";return document.cookie=f,f}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.DateProvider=(class{getNowLocal(){return new Date}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.WidgetConditionsService=(class{constructor(n,t,i){this.logger=n;this.utilities=t;this.windowProvider=i}checkConditions(n){let t=this.getConditionCheckers(n.conditions,n.id);return this.checkWithConditionCheckers(t)}CheckAudienceConditions(n,t){let i=this.getConditionCheckers(n,t);return this.checkWithConditionCheckers(i)}getConditionCheckers(i,r){let f=new t.Tracker(this.logger,this.windowProvider);if(!i||0==i.length)return this.logger.debug(`Widget '${r}': No conditions found`),[];let u=[];for(let e of i)switch(e.type){case n.Widgets.WidgetConditionType.QueryParam:u.push(new t.QueryParameterConditionChecker(e,this.windowProvider));break;case n.Widgets.WidgetConditionType.UTMCampaign:u.push(new t.UTMCampaignConditionChecker(e,f.getVisit(),this.windowProvider));break;case n.Widgets.WidgetConditionType.UTMSource:u.push(new t.UTMSourceConditionChecker(e,f.getVisit(),this.windowProvider));break;case n.Widgets.WidgetConditionType.UTMMedium:u.push(new t.UTMMediumConditionChecker(e,f.getVisit(),this.windowProvider));break;case n.Widgets.WidgetConditionType.BrowserLanguage:u.push(new t.BrowserLanguageConditionChecker(e));break;case n.Widgets.WidgetConditionType.FacebookVisit:u.push(new t.FacebookVisitConditionChecker(e));break;case n.Widgets.WidgetConditionType.InstagramVisit:u.push(new t.InstagramVisitConditionChecker(e));break;case n.Widgets.WidgetConditionType.OtherSocialMediaVisit:u.push(new t.SocialMediaVisitConditionChecker(e));break;case n.Widgets.WidgetConditionType.MarketingEmailVisit:u.push(new t.MarketingEmailConditionChecker(e,this.windowProvider));break;case n.Widgets.WidgetConditionType.CookieEquals:case n.Widgets.WidgetConditionType.CookieExists:u.push(new t.UsersCookieConditionChecker(e,this.utilities));break;case n.Widgets.WidgetConditionType.JsExpression:u.push(new t.JsExpressionChecker(this.logger,r,e));break;case n.Widgets.WidgetConditionType.OnlyMobile:u.push(new t.OnlyMobileConditionChecker(this.utilities));break;case n.Widgets.WidgetConditionType.OnlyDesktop:u.push(new t.OnlyDesktopConditionChecker(this.utilities));break;case n.Widgets.WidgetConditionType.Domain:u.push(new t.DomainConditionChecker(e,this.windowProvider));break;case n.Widgets.WidgetConditionType.NewVisitor:u.push(new t.NewVisitorConditionChecker(this.logger,e,f.getPerson()));break;case n.Widgets.WidgetConditionType.ReturningVisitor:u.push(new t.ReturningVisitorConditionChecker(this.logger,e,f.getPerson()));break;case n.Widgets.WidgetConditionType.CampaignOpened:u.push(new t.CampaignOpenedConditionChecker(this.logger,e,f.getPerson()));break;case n.Widgets.WidgetConditionType.CampaignDismissal:u.push(new t.CampaignDismissalConditionChecker(this.logger,e,f.getPerson()));break;case n.Widgets.WidgetConditionType.CampaignConversion:u.push(new t.CampaignConversionConditionChecker(this.logger,e,f.getPerson()));break;case n.Widgets.WidgetConditionType.CampaignClickthrough:u.push(new t.CampaignClickthroughConditionChecker(this.logger,e,f.getPerson()))}return u}checkWithConditionCheckers(n){let t=!0;for(let i of n)t=t&&i.canBeOpened();return t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.RepetitionCheckService=(class{constructor(n,t,i,r){this.logger=n;this.widgetCloseService=t;this.trackerService=i;this.visitorStateService=r}checkRepetitions(n){if(!this.widgetCloseService.isClosed(n.id))return!1;let t=n.repetitions;if(!t||t.length<1)return this.logger.warn(`Widget '${n.id}': No repetition found`),!1;let r=this.getCheckers(n,t);if(0===r.length)return!1;let i=!0;for(let n of r)i=i&&n.shouldShowNow();return i}getCheckers(i,r){let u=[],f=this.widgetCloseService.getClosedWidgetData(i.id);return r.forEach(r=>{if(r.type==f.reason)switch(r.option){case n.Widgets.RepetitionOption.ContinueShowing:u.push(new t.ContinueShowingChecker(i,this.widgetCloseService));break;case n.Widgets.RepetitionOption.DisableShowingForXMinutes:u.push(new t.DisableShowingForXMinutesChecker(i,r,this.widgetCloseService,this.trackerService));break;case n.Widgets.RepetitionOption.DisableShowingForXPageViews:u.push(new t.DisableShowingForXPageviewsChecker(i,r,this.widgetCloseService,this.visitorStateService));break;default:u.push(new t.DoNotShowAgainChecker)}}),u}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.SplitInputsToStepsService=(class{constructor(n,t){this.logger=n;this.formsService=t}connectEnterKeyToInput(n,t,i,r,u){i.querySelectorAll(".state").forEach(f=>{this.formsService.getFormFields(f,"input").length>0&&f.addEventListener("keypress",f=>{"Enter"===f.key&&f.target instanceof HTMLInputElement&&this.slidingFormValidateAndSwitchStepComponents(n,t,1,i,r,u)})})}handleSlidingFormToSplitInputsToSteps(t,i){var u,f,e,r;if(!0===i.splitInputsToSteps){let h,o=[...t.querySelectorAll(".component")],l=o.find(n=>n.classList.contains("component-buttonsubmit")),v=!!l,w=!!o.find(n=>"backButton"===n.getAttribute("data-external-id")),a=v?null===(u=l.closest(".container[data-container-id]"))||void 0===u?void 0:u.getAttribute("data-container-id"):void 0;if(!a||!v||!w)return void this.logger.info("The form has enabled splitting but is missing conditions for it so it will not be split");const y=this.getSubmitButtonTextElement(l).innerText;let c=!1;const s=[];for(r=0;r<o.length;r++){if(o[r].classList.contains("component-inputtextemail")||o[r].classList.contains("component-inputtext")||o[r].classList.contains("component-dropdown")||o[r].classList.contains("component-date")||o[r].classList.contains("component-buttonlist"))if(o[r].parentElement.classList.contains("component-group")){const i=o[r].parentElement.getAttribute("data-id"),t=s.findIndex(n=>n.id===i);-1!==t?s[t].children.push(o[r].getAttribute("data-component")):s.push({type:n.SlidingFormStepType.ComponentGroup,id:o[r].parentElement.getAttribute("data-id"),children:[o[r].getAttribute("data-component")]});o[r].parentElement.classList.add("step-component");c||(o[r].parentElement.classList.add("first-step-component"),c=!0)}else null!=o[r].parentElement.getAttribute("data-container-id")&&(s.push({type:n.SlidingFormStepType.Component,id:o[r].getAttribute("data-component"),children:[]}),o[r].classList.add("step-component"),c||(o[r].classList.add("first-step-component"),c=!0));o[r].classList.contains("component-buttonsubmit")&&o[r].querySelector("button").classList.add("step-component-submit-button");"backButton"===o[r].getAttribute("data-external-id")&&(o[r].querySelector("button").classList.add("step-component-back-button"),h=h=o[r].querySelector("button").onclick)}this.injectProgressIndicator(a,s,i.slidingFormConfig,t);const p={widgetId:i.id,formSteps:s,containerWithFormId:a,currentTab:0,slidingFormProgressStyle:i.slidingFormConfig?i.slidingFormConfig.progressStyle:void 0,nextButtonText:null!==(e=null===(f=i.slidingFormConfig)||void 0===f?void 0:f.nextButtonText)&&void 0!==e?e:"Next"};this.connectEnterKeyToInput(p,i,t,h,y);this.slidingFormShowTab(p,i,1,t,h,y)}}injectProgressIndicator(t,i=[],r,u){if(r&&r.progressStyle){for(var e=u.querySelectorAll(".container"),f=0;f<e.length;f++)if(t===e[f].getAttribute("data-container-id"))if(r.progressStyle===n.SlidingFormProgressStyle.Dots){let n='<div class="sliding-form-progress-container">';for(let t=0;t<i.length;t++)n+='<div class="sliding-form-progress-section">',n+='<div class="progress-circle"><\/div>',t<i.length-1&&(n+='<div class="progress-line"><\/div>'),n+="<\/div>";n+="<\/div>";e[f].insertAdjacentHTML("beforeend",n);e[f].style.overflowX="hidden"}else if(r.progressStyle===n.SlidingFormProgressStyle.ProgressBar){let n='<div class="sliding-form-progress-container">';for(let t=0;t<i.length;t++)n+='<span class="sliding-form-progress-section progress-bar"><\/span>';n+="<\/div>";e[f].insertAdjacentHTML("beforeend",n);e[f].style.overflowX="hidden"}}else this.logger.debug("There should be no progress indicator on this sliding form")}slidingFormShowTab(n,t,i,r,u,f){const e=n.currentTab;for(var o=r.querySelectorAll(".step-component"),s=0;s<o.length;s++)s<e&&(o[s].classList.remove("step-component-in"),o[s].classList.remove("step-component-out"));o[e].style.display="flex";setTimeout(()=>{null!=o[e].querySelector("input")?o[e].querySelector("input").focus():null!=o[e].querySelector("textarea")?o[e].querySelector("textarea").focus():null!=o[e].querySelector("select")&&o[e].querySelector("select").focus()},500);o[e].className+=i>-1?" step-component-in":" step-component-out";e==o.length-1?(this.slidingFormSetSubmitButtonToSubmit(n,t,r,u,f),this.toggleConsentCheckboxOnStep(!0,r)):(this.slidingFormSetSubmitButtonToNext(n,t,r,u,f),this.toggleConsentCheckboxOnStep(!1,r));0==e?this.slidingFormSetBackButtonToCancel(r):this.slidingFormSetBackButtonToBack(n,t,r,u,f);n.slidingFormProgressStyle&&this.slidingFormFixStepIndicator(e,r)}toggleConsentCheckboxOnStep(n,t){const i=t.querySelector(".component-checkboxconsent");null!=i&&(!0===n?(i.classList.add("consent-component-in"),i.style.display="flex"):i.style.display="none")}getSubmitButton(n){return n.querySelector(".step-component-submit-button")}getSubmitButtonTextElement(n){return n.querySelector("p")||n.querySelector("div")}slidingFormSetSubmitButtonToNext(n,t,i,r,u){const f=this.getSubmitButton(i);this.getSubmitButtonTextElement(f).innerHTML=n.nextButtonText;f.type="button";f.onclick=()=>{this.slidingFormValidateAndSwitchStepComponents(n,t,1,i,r,u)}}slidingFormSetSubmitButtonToSubmit(n,t,i,r,u){const f=this.getSubmitButton(i);this.getSubmitButtonTextElement(f).innerHTML=u;f.onclick=()=>{this.slidingFormValidateAndSwitchStepComponents(n,t,1,i,r,u)}}slidingFormSetBackButtonToCancel(n){n.querySelector(".step-component-back-button").style.display="none"}slidingFormSetBackButtonToBack(n,t,i,r,u){i.querySelector(".step-component-back-button").style.display="flex";i.querySelector(".step-component-back-button").onclick=()=>{this.slidingFormMoveStep(n,t,-1,i,r,u)}}slidingFormValidateAndSwitchStepComponents(n,t,i,r,u,f){let e=!1;if(null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("input")?e=r.querySelectorAll(".step-component")[n.currentTab].querySelector("input").checkValidity():null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("textarea")?e=r.querySelectorAll(".step-component")[n.currentTab].querySelector("textarea").checkValidity():null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("select")&&(e=r.querySelectorAll(".step-component")[n.currentTab].querySelector("select").checkValidity()),!0===e){if(n.slidingFormProgressStyle){r.querySelectorAll(".sliding-form-progress-section")[n.currentTab].className+=" finish";let t=r.querySelectorAll(".sliding-form-progress-section")[n.currentTab];t.querySelector(".progress-circle").className+=" finish";let i=t.querySelector(".progress-line");i&&(i.className+=" finish")}-1!==i?n.formSteps.length-1===n.currentTab?r.querySelector(".step-component-submit-button").type="submit":this.slidingFormNextStep(n,t,r,u,f):this.slidingFormPreviousStep(n,t,r,u,f)}else null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("input")?r.querySelectorAll(".step-component")[n.currentTab].querySelector("input").reportValidity():null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("textarea")?r.querySelectorAll(".step-component")[n.currentTab].querySelector("textarea").reportValidity():null!=r.querySelectorAll(".step-component")[n.currentTab].querySelector("select")&&r.querySelectorAll(".step-component")[n.currentTab].querySelector("select").reportValidity()}slidingFormNextStep(n,t,i,r,u){this.slidingFormMoveStep(n,t,1,i,r,u);this.formsService.partialSubmit(t.id,!1)}slidingFormPreviousStep(n,t,i,r,u){0===n.currentTab?i.querySelector(".step-component-back-button").onclick=r:this.slidingFormMoveStep(n,t,-1,i,r,u)}slidingFormMoveStep(n,t,i,r,u,f){var e=r.querySelectorAll(".step-component");if(e[n.currentTab].style.display="none",n.currentTab=n.currentTab+i,n.currentTab>=e.length)return!1;this.slidingFormShowTab(n,t,i,r,u,f)}slidingFormFixStepIndicator(n,t){for(var r=t.querySelectorAll(".sliding-form-progress-section"),i=0;i<r.length;i++)r[i].className=r[i].className.replace(" active","");r[n].className+=" active"}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetSchedulingService=(class{constructor(n,t){this.logger=n;this.dateProvider=t;this.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}checkConditions(n){const t=n.scheduling;if(!t)return!0;const i=this.dateProvider.getNowLocal(),r=i.toLocaleDateString("sv-SE");return!(t.startDate&&t.startDate>r)&&!(t.endDate&&t.endDate<r)&&!(t.customDays&&t.customDays.length>0&&-1==t.customDays.findIndex(n=>n===this.days[i.getDay()]))&&!(t.customHours&&t.customHours.length>0&&-1==t.customHours.findIndex(n=>n===i.getHours()))}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.AudienceChecker=(class{constructor(n,t,i,r,u,f,e){this.logger=n;this.httpClient=t;this.windowProvider=i;this.tracker=r;this.visitorStateService=u;this.widgetConditionsService=f;this.widgetUtilities=e;this.window=this.windowProvider.get();this.registerEventListeners()}checkAsync(i){return t(this,void 0,void 0,function*(){try{const f=this.tracker.getUid(),r=this.widgetUtilities.getCurrentSiteId();let t=!1;const u=null!=i.sessionConditionGroup&&this.widgetConditionsService.CheckAudienceConditions(i.sessionConditionGroup.sessionConditions,i.id);if(null==i.audience||i.audience.filters&&i.audience.filters.length>0){const n=this.getVisitorState().checkedAudiences.find(n=>n.audienceId==i.audienceId&&n.siteId==r);if(n)t=n.result;else{const n=this.checkAudienceInBrowser(i);t=n.canCheck?n.result:yield this.checkWithApiAsync(f,r,i)}}else t=!0;return null==i.sessionConditionGroup||0===i.sessionConditionGroup.sessionConditions.length?t:i.sessionConditionGroup.operator===n.SessionConditionGroupOperator.And?t&&u:t||u}catch(n){return this.logger.error(`Widget '${i.id}': Could not check audience '${i.audienceId}'`),!1}})}checkAudienceInBrowser(t){if(t.audience){const u=this.tracker.getPerson(),r=u&&void 0!==u.identifier;for(var i=0;i<t.audience.filters.length;i++){const u=t.audience.filters[i];if(u.type===n.AudienceFilterType.Identified)return"true"!==u.value?{canCheck:r,result:!r}:{canCheck:r,result:r}}}return{canCheck:!1,result:!1}}checkWithApiAsync(i,r,u){return t(this,void 0,void 0,function*(){if(!i)return this.logger.warn("No uid found before checking audience, cookie probably deleted or not allowed to be set"),!1;const s=this.window.triggerbee.widgets.clientGatewayUrl;let f=new n.AudienceCheckRequest(i,r);const e=this.tracker.getVisit(),o=this.tracker.getPerson();if(e||o){let t=new n.AudienceClientDataRequest(e,o);f.clientData=t}let h=`${s}/audiences/${u.audienceId}/check`;const t=yield this.httpClient.postAsync(h,f);if(this.logger.debug(`Checked audience '${u.audienceId}' for widget '${u.id}'. Response: '${JSON.stringify(t)}'`),200===t.statusCode){const n={audienceId:u.audienceId,siteId:r,result:t.data.result},i=this.getVisitorState();return i.checkedAudiences.push(n),this.visitorStateService.setCurrentState(i),n.result}return!1})}getVisitorState(){const t=this.visitorStateService.getCurrentState()||new n.VisitorState;return t.checkedAudiences||(t.checkedAudiences=[]),t}registerEventListeners(){const n=this;document.addEventListener("triggerbeeTagAdded",function(){n.removeAudienceCache()});document.addEventListener("triggerbeeGoalAdded",function(){n.removeAudienceCache()});document.addEventListener("triggerbeePersonIdentified",function(){n.removeAudienceCache()});document.addEventListener("triggerbeePersonConsented",function(){n.removeAudienceCache()})}removeAudienceCache(){const n=this.getVisitorState();n.checkedAudiences=void 0;this.visitorStateService.setCurrentState(n)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WindowProvider=(class{get(){return window}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.DocumentProvider=(class{get(){return document}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.HttpResponseWrapper=(class{constructor(n,t){this.data=n;this.statusCode=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.HttpClient=(class{constructor(n,t){this.widgetUtilities=n;this.tracker=t}getDefaultHeaders(){return new Headers({"X-Site-Id":this.widgetUtilities.getCurrentSiteId().toString(),"X-Uid":this.tracker.getUid().toString()})}postAsync(n,i){return t(this,void 0,void 0,function*(){const t={method:"POST",body:JSON.stringify(i),headers:this.getDefaultHeaders()};return t.headers.append("Content-type","application/json; charset=utf-8"),yield this.requestAsync(n,t,!0)})}getAsync(n){return t(this,void 0,void 0,function*(){const t={method:"GET",headers:this.getDefaultHeaders()};return yield this.requestAsync(n,t,!0)})}getHtmlAsync(n){return t(this,void 0,void 0,function*(){const t={method:"GET",headers:this.getDefaultHeaders()};return yield this.requestAsync(n,t,!1)})}requestAsync(i,r,u){return t(this,void 0,void 0,function*(){const t=yield fetch(i,r),f=u?yield t.json():yield t.text();return new n.HttpResponseWrapper(f,t.status)})}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ArrayHelper=(class{static groupBy(n,t){return n.reduce((n,i)=>((n[i[t]]=n[i[t]]||[]).push(i),n),{})}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ProductRecommendationsService=(class{constructor(n,t,i,r,u){this.httpClient=n;this.windowProvider=t;this.tracker=i;this.widgetUtilities=r;this.widgetPreviewService=u;this.window=this.windowProvider.get();this.baseUrl=this.window.triggerbee.widgets.clientGatewayUrl;this.registerEventListeners()}registerEventListeners(){const n=this;this.window.document.addEventListener("triggerbeePersonIdentified",function(i){return t(this,void 0,void 0,function*(){if(n.shouldIssueToken(n,i)){const t=i.detail.identifier,r=n.widgetUtilities.getCurrentSiteId(),u=n.tracker.getUid();yield n.httpClient.postAsync(`${n.baseUrl}/tokens/issue`,{siteId:r,uid:u,identifier:t})}})})}shouldIssueToken(n,t){return t.detail.isPreviouslyIdentified?!1:n.widgetUtilities.getConfiguredWidgets().some(t=>!!n.getProductRecommendationProperties(t))}getProductRecommendationProperties(n){if(n.states)for(let t of n.states)for(let n of t.containers)for(let t of n.components)if(t.productRecommendationProperties)return t.productRecommendationProperties}getProductRecommendations(n,i){return t(this,void 0,void 0,function*(){const t=this.widgetUtilities.getCurrentSiteId(),r=this.tracker.getUid();return(yield this.httpClient.postAsync(`${this.baseUrl}/widgets/${n.id}/product-recommendations/visitors/${r}?isPreview=${this.widgetPreviewService.isPreview()}`,{siteId:t,landingPageQueryParams:this.tracker.getVisit().landingPageQueryParams,productIds:i})).data})}});n.ProductRecommendationsResponse=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){var t;(function(n){class t{startCounting(t,i){if(t.states)for(let r of t.states)for(let t of r.containers)for(let r of t.components)r.type===n.ComponentType.Deadline&&r.deadlineProperties&&(this.tick(r,i),(()=>{var n=setInterval(()=>{this.tick(r,i)&&clearInterval(n)},1e3)})())}tick(t,i){const f=new Date,e=new Date(t.deadlineProperties.deadlineDate);t.deadlineProperties.deadlineOccurrence===n.DeadlineOccurence.EveryDay&&(e.setFullYear(f.getFullYear()),e.setMonth(f.getMonth()),e.setDate(f.getDate()));let r=e.getTime()-f.getTime();if(r<0)return eval(t.script),!0;let o=~~(r/864e5);r%=864e5;let u=~~(r/36e5);r%=36e5;let s=~~(r/6e4);r%=6e4;const h=~~(r/1e3),c=t.deadlineProperties.format===n.DeadlineFormat.HoursMinutesSeconds||t.deadlineProperties.format===n.DeadlineFormat.MinutesSeconds||t.deadlineProperties.format==n.DeadlineFormat.Hours,l=t.deadlineProperties.format===n.DeadlineFormat.MinutesSeconds||t.deadlineProperties.format===n.DeadlineFormat.Days;return c&&(u=24*o+u,o=0),l&&(s=60*u+s,u=0),this.assignValue(i,t.id,"days",o,!1),this.assignValue(i,t.id,"hours",u,!1),this.assignValue(i,t.id,"minutes",s,!1),this.assignValue(i,t.id,"seconds",h,!0),!1}assignValue(n,t,i,r,u){const f=n.querySelector(`.deadline-component[data-id="${t}"] .${i} .deadline-section-value-overlay`),e=~~(r/10),o=~~(r%10);this.assignOneDigit(f,1,e,t,u);this.assignOneDigit(f,2,o,t,u)}assignOneDigit(n,t,i,r,u){if(n){const e=n.querySelector(`.deadline-section-value${t}`),f=n.querySelector(`.deadline-section-slide${t}`);if(e&&f)return""!==e.innerHTML.trim()&&u?void(f.innerHTML!==i.toString()&&(e.classList.remove("animation-"+r),f.classList.remove("animation-"+r),e.innerHTML=f.innerHTML,f.innerHTML=i.toString(),e.clientWidth,f.clientWidth,e.classList.add("animation-"+r),f.classList.add("animation-"+r))):(e.innerHTML=i.toString(),void(f.innerHTML=i.toString()))}}}n.DeadlineComponentService=t})(t=n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ButtonListComponentService=(class{constructor(n){this.logger=n}initialize(t,i){i.querySelectorAll(".button-list-component").forEach(n=>{this.prefill(n,t)});i.querySelectorAll(".button-list-component .widget-component-button-list-item-mobile").forEach(n=>{n.addEventListener("click",()=>{this.onClickMobile(t,n)})});i.querySelectorAll(".button-list-component .widget-component-button-list-item").forEach(i=>{i.addEventListener("click",()=>{this.onClick(t,i)});let r=this.getComponent(i,t);this.isSubType(r.subType,n.ComponentSubType.ButtonListStarRating)?(i.addEventListener("mouseenter",()=>{this.uncheckAndCheckStars(r,i)}),i.addEventListener("mouseleave",()=>{this.onMouseLeave(r,i)})):this.isSubType(r.subType,n.ComponentSubType.ButtonListSmileyRating)?(i.addEventListener("mouseenter",()=>{this.onMouseEnterSmiley(r,i)}),i.addEventListener("mouseleave",()=>{this.onMouseLeaveSmiley(r,i)})):this.isNumericalOrNps(r)?(i.addEventListener("mouseenter",()=>{this.onMouseEnterNumerical(r,i)}),i.addEventListener("mouseleave",()=>{this.onMouseLeaveNumerical(r,i)})):r.subType==n.ComponentSubType.ButtonListThumbRating&&(i.addEventListener("mouseenter",()=>{this.onMouseEnterThumbs(r,i)}),i.addEventListener("mouseleave",()=>{this.onMouseLeaveThumbs(r,i)}))});this.addWowEffectsToSurveyComponents(i,t)}isNumericalOrNps(t){return this.isSubType(t.subType,n.ComponentSubType.ButtonListNumericalRating)||this.isSubType(t.subType,n.ComponentSubType.ButtonListNpsRating)}getComponent(n,t){const i=n.closest(".actual-element").getAttribute("data-id");return this.findComponent(t,+i)}isSubType(t,i){return t==n.ComponentSubType.ButtonListCsatStarRating&&(t=n.ComponentSubType.ButtonListStarRating),t==n.ComponentSubType.ButtonListCsatSmileyRating&&(t=n.ComponentSubType.ButtonListSmileyRating),t==n.ComponentSubType.ButtonListCsatNumericalRating&&(t=n.ComponentSubType.ButtonListNumericalRating),i==t}prefill(t,i){const e=this.getHiddenInput(t),f=e.value;if(null!=f&&""!==f){const u=Array.from(t.querySelectorAll(".widget-component-button-list-item")).find(n=>n.getAttribute("data-value")===f);if(!u)return void(e.value=null);const r=this.getComponent(t,i);this.isSubType(r.subType,n.ComponentSubType.ButtonListStarRating)?this.uncheckAndCheckStars(r,u):this.isSubType(r.subType,n.ComponentSubType.ButtonListSmileyRating)?this.uncheckAndCheckSmiley(u,r):this.isNumericalOrNps(r)?this.uncheckAndCheckNumerical(r,u):this.check(r,u)}}addWowEffectsToSurveyComponents(t,i){i.states&&i.states.forEach(i=>{i.containers&&i.containers.forEach(i=>{i.components&&i.components.forEach(i=>{if(i.type==n.ComponentType.ButtonList&&i.buttonListProperties.selectEffect==n.SelectEffect.FancyBlink){const n=t.querySelector(`[data-component="${i.id}"`).querySelectorAll(".widget-component-button-list-item");n&&n.forEach((n,t)=>{const r=t==i.listItems.length-1||i.listItems.length>3&&t>i.listItems.length-3;n.addEventListener("click",()=>this.confettiAnimation(n,r))})}})})})}confettiAnimation(n,t){const e=n.querySelector(".icon-img")||n,r=n.querySelector(".satellites");if(r){const u=r.children,i=["#a864fd","#29cdff","#78ff44","#ff718d","#ffe600","#05d572"],f={duration:300,easing:"cubic-bezier(.08,.82,.17,1)",fill:"forwards"};if(e.classList.add("grow"),setTimeout(()=>{e.classList.remove("grow"),r.classList.add("invisible")},500),t){r.style.cssText=`transform: scale(${e.clientHeight/60});`;r.classList.remove("invisible");for(let n=0,t=u[n];n<i.length;n++,t=u[n]){const r=Math.round(n/i.length*360);t.style.cssText=`background-color: ${i[n]}; width: 5px`;t.animate({transform:[`rotate(${r}deg) translateY(0) scale(1)`,`rotate(${r}deg) translateY(60px) scale(1)`],opacity:[1]},f)}setTimeout(()=>{f.duration=250;for(let n=0,t=u[n];n<i.length;n++,t=u[n]){const r=Math.round(n/i.length*360)+15;t.style.cssText=`border: 1px solid ${i[n]}; width: 14px`;t.animate({transform:[`rotate(${r}deg) translateY(60px) scale(3)`],opacity:[1,0]},f)}},f.duration)}}}updateContents(t,i,r){let f,e;t.buttonListProperties&&t.buttonListProperties.selectEffect==n.SelectEffect.FancyBlink&&(f=t.buttonListProperties.checkedIconUrl&&t.subType==n.ComponentSubType.ButtonListRadio&&t.buttonListProperties.checkedIconUrl.includes("radio_black_on.svg")||t.subType==n.ComponentSubType.ButtonListCheckbox&&t.buttonListProperties.checkedIconUrl.includes("square-checked.svg"),e=t.buttonListProperties.uncheckedIconUrl&&t.subType==n.ComponentSubType.ButtonListRadio&&t.buttonListProperties.uncheckedIconUrl.includes("radio_black_off.svg")||t.subType==n.ComponentSubType.ButtonListCheckbox&&t.buttonListProperties.uncheckedIconUrl.includes("square-empty.svg"));const u=i.querySelector(".widget-component-button-list-item-icon-wrapper"),o=t.subType==n.ComponentSubType.ButtonListRadio?"radio":"checkbox";if(r)if(f){if(t.subType==n.ComponentSubType.ButtonListCheckbox){const n=u.parentElement;n?n.style.setProperty("--iconSize",t.buttonListProperties.iconSize+"px"):this.logger.warn(`Could not find expected icon parent element for component: ${t.id}`)}this.setIconInnerHtml(u,t,`<div class="default-${o}-icon-checked"></div>`)}else this.setIconInnerHtml(u,t,"<img/>"),this.updateStyles(t,i);else e?this.setIconInnerHtml(u,t,`<div class="default-${o}-icon-unchecked"></div>`):(this.setIconInnerHtml(u,t,"<img/>"),this.updateStyles(t,i))}setIconInnerHtml(n,t,i){n?n.innerHTML=i:this.logger.warn(`Could not find expected icon element for component: ${t.id}`)}onClickMobile(n,t){const i=this.getComponent(t,n),u=this.getHiddenInput(t);this.clickAnimation(t,i);this.uncheckAndCheckNpsMobile(i,t);u.value=t.getAttribute("data-value");const r=t.closest(".actual-element").querySelector(".button-list-component-action-button");r&&r.click()}onClick(t,i){const r=this.getComponent(i,t),u=this.getHiddenInput(i);if(this.clickAnimation(i,r),this.isSubType(r.subType,n.ComponentSubType.ButtonListStarRating))this.uncheckAndCheckStars(r,i),u.value=i.getAttribute("data-value");else if(this.isSubType(r.subType,n.ComponentSubType.ButtonListSmileyRating))this.uncheckAndCheckSmiley(i,r),u.value=i.getAttribute("data-value");else if(this.isNumericalOrNps(r))this.uncheckAndCheckNumerical(r,i),u.value=i.getAttribute("data-value");else if(r.buttonListProperties.allowMultipleSelection){i.classList.contains("checked")?this.unCheck(r,i):this.check(r,i);const n=this.getAllSiblings(i,!0).filter(n=>n.classList.contains("widget-component-button-list-item")&&n.classList.contains("checked"));u.value=n.map(n=>n.getAttribute("data-value")).join(";")}else{this.check(r,i);const n=i.getAttribute("data-value");u.value=n;this.getAllSiblings(i,!1).filter(n=>n.classList.contains("widget-component-button-list-item")).forEach(n=>this.unCheck(r,n))}const f=i.closest(".actual-element").querySelector(".button-list-component-action-button");f&&f.click()}clickAnimation(t,i){var r;(null===(r=i.buttonListProperties)||void 0===r?void 0:r.selectEffect)===n.SelectEffect.Blink&&this.blinkImage(t,2)}onMouseLeave(n,t){const i=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item"));i.forEach(t=>this.unCheckStar(n,t));const r=this.getHiddenInput(t);if(r.value){const t=i.find(n=>n.getAttribute("data-value")==r.value);t&&this.uncheckAndCheckStars(n,t)}}onMouseLeaveSmiley(n,t){const i=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item"));let r=this.checkIfAllSmileysHaveUncheckedIcons(i,n);r?i.forEach(t=>this.unCheckSmiley(t,n)):i.forEach(t=>this.checkSmiley(t,n));const u=this.getHiddenInput(t);if(u.value){const t=i.find(n=>n.getAttribute("data-value")==u.value);t&&this.uncheckAndCheckSmiley(t,n)}else r?i.forEach(t=>this.unCheckSmiley(t,n)):i.forEach(t=>this.checkSmiley(t,n))}checkIfAllSmileysHaveUncheckedIcons(n,t){for(let i=0;i<n.length;i++){const r=+n[i].getAttribute("data-id");if(!t.listItems.find(n=>n.id===r).uncheckedIconUrl)return!1}return!0}onMouseEnterSmiley(n,t){this.uncheckAndCheckSmiley(t,n);const r=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item")),i=this.getHiddenInput(t);if(i.value){const t=r.find(n=>n.getAttribute("data-value")==i.value);t&&this.checkSmiley(t,n)}}onMouseLeaveThumbs(n,t){const i=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item"));i.forEach(t=>this.unCheckThumb(n,t));const r=this.getHiddenInput(t);if(r.value){const t=i.find(n=>n.getAttribute("data-value")==r.value);t&&this.uncheckAndCheckThumb(n,t)}}onMouseEnterThumbs(n,t){this.uncheckAndCheckThumb(n,t);const r=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item")),i=this.getHiddenInput(t);if(i.value){const t=r.find(n=>n.getAttribute("data-value")==i.value);t&&this.checkThumb(n,t)}}onMouseLeaveNumerical(n,t){const r=this.getAllSiblings(t,!0).filter(n=>n.classList.contains("widget-component-button-list-item")),i=this.getHiddenInput(t);if(i.value){const t=r.find(n=>n.getAttribute("data-value")==i.value);t&&this.uncheckAndCheckNumerical(n,t)}else this.unCheckNumerical(n,t)}getHiddenInput(n){return n.closest(".actual-element").querySelector('input[type="text"].text-field')}onMouseEnterNumerical(n,t){this.checkNumerical(n,t)}uncheckAndCheckSmiley(n,t){this.checkSmiley(n,t);this.getAllSiblings(n,!1).filter(n=>n.classList.contains("widget-component-button-list-item")).forEach(n=>this.unCheckSmiley(n,t))}uncheckAndCheckThumb(n,t){this.checkThumb(n,t);this.getAllSiblings(t,!1).filter(n=>n.classList.contains("widget-component-button-list-item")).forEach(t=>this.unCheckThumb(n,t))}uncheckAndCheckStars(n,t){let i=this.getPreviousSiblings(t,!0),r=this.getFollowingSiblings(t,!1);for(const t of i)t.classList.contains("widget-component-button-list-item")&&this.checkStar(n,t);for(const t of r)t.classList.contains("widget-component-button-list-item")&&this.unCheckStar(n,t)}getPreviousSiblings(n,t){let r=[],i=t?n:n.previousElementSibling;for(;i;)r.push(i),i=i.previousElementSibling;return r}getFollowingSiblings(n,t){let r=[],i=t?n:n.nextElementSibling;for(;i;)r.push(i),i=i.nextElementSibling;return r}getAllSiblings(n,t){let i=[],r=n.previousElementSibling;for(;r;)i.push(r),r=r.previousElementSibling;i=i.reverse();t&&i.push(n);let u=n.nextElementSibling;for(;u;)i.push(u),u=u.nextElementSibling;return i}findComponent(n,t){for(const i of n.states)for(const n of i.containers)for(const i of n.components)if(i.id===t)return i}checkStar(n,t){t.classList.add("checked");this.updateStarStyle(n,t)}unCheckStar(n,t){t.classList.remove("checked");this.updateStarStyle(n,t)}checkSmiley(n,t){n.classList.add("checked");const i=+n.getAttribute("data-id");t.listItems.find(n=>n.id===i).uncheckedIconUrl?this.updateStyles(t,n):n.classList.remove("grey-scale")}unCheckSmiley(n,t){n.classList.remove("checked");const i=+n.getAttribute("data-id");t.listItems.find(n=>n.id===i).uncheckedIconUrl?this.updateStyles(t,n):n.classList.add("grey-scale")}checkThumb(n,t){t.classList.add("checked");this.updateStyles(n,t)}unCheckThumb(n,t){t.classList.remove("checked");this.updateStyles(n,t)}check(n,t){t.classList.add("checked");const i=t.querySelector(".additional-field input");i&&(i.setAttribute("required",""),i.focus());this.updateContents(n,t,!0)}uncheckAndCheckNumerical(n,t){this.checkNumerical(n,t);this.getAllSiblings(t,!1).filter(n=>n.classList.contains("widget-component-button-list-item")).forEach(t=>this.unCheckNumerical(n,t))}uncheckAndCheckNpsMobile(n,t){this.checkNumerical(n,t);const i=t.parentNode.parentNode;Array.from(i.querySelectorAll(".widget-component-button-list-item-mobile")).filter(n=>n!==t).forEach(t=>{this.unCheckNumerical(n,t)})}checkNumerical(n,t){t.classList.add("checked");this.updateNumericalStyle(n,t)}unCheck(n,t){t.classList.remove("checked");const i=t.querySelector(".additional-field input");i&&i.removeAttribute("required");this.updateContents(n,t,!1)}updateStarStyle(n,t){const i=n.buttonListProperties;if(i){const r=t.querySelector("path");t.classList.contains("checked")?r.setAttribute("fill",i.checkedFontColor):r.setAttribute("fill",i.uncheckedFontColor)}}updateStyles(n,t){const r=n.buttonListProperties;if(r){const e=+t.getAttribute("data-id"),u=n.listItems.find(n=>n.id===e),f=t.querySelector("img"),i=t;t.classList.contains("checked")?(f.src=u.checkedIconUrl||r.checkedIconUrl,this.setCheckedHtmlStyle(i,r)):(f.src=u.uncheckedIconUrl||r.uncheckedIconUrl,this.setUncheckedHtmlStyle(i,r));(i.style.borderTop||i.style.borderRight||i.style.borderBottom||i.style.borderLeft)&&(i.style.borderStyle="solid")}}updateNumericalStyle(n,t){const r=n.buttonListProperties,i=t;t.classList.contains("checked")?this.setCheckedHtmlStyle(i,r):this.setUncheckedHtmlStyle(i,r);(i.style.borderTop||i.style.borderRight||i.style.borderBottom||i.style.borderLeft)&&(i.style.borderStyle="solid")}unCheckNumerical(n,t){t.classList.remove("checked");this.updateNumericalStyle(n,t)}setUncheckedHtmlStyle(n,t){n.style.color=t.uncheckedFontColor;n.style.backgroundColor=t.uncheckedBackgroundColor;n.style.borderTop=t.uncheckedBorderTop;n.style.borderRight=t.uncheckedBorderRight;n.style.borderBottom=t.uncheckedBorderBottom;n.style.borderLeft=t.uncheckedBorderLeft}setCheckedHtmlStyle(n,t){n.style.color=t.checkedFontColor;n.style.backgroundColor=t.checkedBackgroundColor;n.style.borderTop=t.checkedBorderTop;n.style.borderRight=t.checkedBorderRight;n.style.borderBottom=t.checkedBorderBottom;n.style.borderLeft=t.checkedBorderLeft}blinkImage(n,t){let i=0;!function r(){i<t&&(n.classList.add("blink"),setTimeout(()=>{n.classList.remove("blink"),i++,setTimeout(r,100)},100))}()}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetComponentsService=(class{getCountriesWithAreaCodes(){return window.triggerbee.widgets.areaCodes}constructor(n){this.logger=n;this.query=""}initialize(n,t){this.initializeReferrals(n,t);t.querySelectorAll(".component-dropdowncountry").forEach(n=>{n.querySelector(".component-wrapper").addEventListener("click",()=>{this.toggleDropdown(n,t)})});document.addEventListener("keydown",i=>{const r=this.dropdownOpen&&this.findComponent(n,this.dropdownOpen);r&&this.searchCountries(i,null==r?void 0:r.countrySelectProperties,this.dropdownOpen,t)});this.initializeInternationalPhone(t)}initializeReferrals(t,i){let r=[];r=navigator.share?this.getComponentsBySubType(t,n.ComponentSubType.ButtonShare):this.getComponentsBySubType(t,n.ComponentSubType.TextCopy);r.forEach(n=>{i.querySelector(`[data-component="${n.id}"]`).classList.remove("hidden")})}getComponentsBySubType(n,t){var i;const r=[];return null===(i=n.states)||void 0===i||i.forEach(n=>{var i;null===(i=n.containers)||void 0===i||i.forEach(n=>{var i;null===(i=n.components)||void 0===i||i.forEach(n=>{n.subType===t&&r.push(n)})})}),r}initializeInternationalPhone(n){const t=n.querySelector(".component-internationalphoneregular");if(t){const r=t.querySelector("input[data-dialcode"),i=t.querySelector("#telephone"),u=t.querySelector(".component-dropdowncountry");this.updateDialCode(n,r,i);i&&i.addEventListener("input",t=>{t.target.value.includes("+")&&this.selectCountryByDialCode(t.target.value.replace(" ","").slice(0,6),u,n)})}}selectCountryByDialCode(n,t,i){const r=this.getCountriesWithAreaCodes();if(!(n.length<=1)){const u=t.querySelectorAll(`[data-dialcode="${n}`);if(u.length>0){const n=[...u].find(n=>{const t=n.getAttribute("data-iso");return!r.find(n=>n.iso==t)});return void this.selectCountry(t,n,i,!0)}const f=r.find(t=>-1!==t.areaCodes.indexOf(n));if(f){const n=t.querySelector(`[data-iso="${f.iso}"`);this.selectCountry(t,n,i,!0)}else this.selectCountryByDialCode(n.slice(0,-1),t,i)}}updateDialCode(n,t,i){i||(i=n.querySelector(".component-internationalphoneregular").querySelector("#telephone"));t?i.value=t.getAttribute("data-dialcode")+" ":this.logger.warn('Could not update dial code. "countryInput" not found')}selectCountry(n,t,i,r){var e;if(t){const o=t.getAttribute("data-iso"),s=null===(e=t.querySelector(".country-label"))||void 0===e?void 0:e.textContent,u=n.querySelector(".dropdown-component-country-value"),f=n.querySelector(".country-flag-placeholder"),h=n.querySelector(".country-label-placeholder");if(f){const n=f.className.split(" ").find(n=>2==n.length);f.classList.remove(n);f.classList.add(o.toLowerCase())}if((h&&s&&(h.innerText=s),u)&&(u.value=o,u.getAttribute("data-dialcode")&&!r)){const n=t.getAttribute("data-dialcode");u.setAttribute("data-dialcode",n);this.updateDialCode(i,u)}}}toggleDropdown(n,t){var r;const i=n.querySelector(".component-wrapper");this.dropdownOpen=this.dropdownOpen?null:Number(n.getAttribute("data-component"));this.dropdownOpen?(i.classList.add("show-content"),i.innerHTML+='<div class="transparent-overlay"><\/div>',n.querySelectorAll(".dropdown-content-country").forEach(i=>{i.addEventListener("click",()=>this.selectCountry(n,i,t))})):(i.classList.remove("show-content"),null===(r=i.querySelector(".transparent-overlay"))||void 0===r||r.remove());this.query=""}getCountriesDisplayed(n){return[...n.querySelectorAll(".dropdown-content-country")].map(n=>{const t=n.querySelectorAll(".country-label");return{label:t.length>0?t[0].textContent:"",subLabel:t.length>1?t[1].textContent.replace("(",""):""}})}searchCountries(n,t,i,r){var e;const f=r.querySelector(`[data-component="${i}"`);if("Enter"==n.key&&this.selectedOption)return this.selectCountry(f,this.selectedOption,r),void this.toggleDropdown(f,r);const o=this.getCountriesDisplayed(f),s=null===(e=f.querySelector(".dropdown-content-country"))||void 0===e?void 0:e.clientHeight;if(s){this.query+=n.key;let u=o.findIndex(n=>n.label.toLowerCase().startsWith(this.query,0));if(-1==u&&(u=o.findIndex(n=>n.subLabel.toLowerCase().startsWith(this.query,0))),-1==u&&(u=o.findIndex(n=>n.label.toLowerCase().includes(this.query,0))),-1!=u){const i=u*s,t=f.querySelector(".dropdown-content-wrapper");t.scroll(0,i);const n=t.children[u];n.style.animation="highlight-anim 1000ms ease-in";setTimeout(()=>n.style.animation="",1e3);this.selectedOption=n}this.queryResetTimer&&clearTimeout(this.queryResetTimer);this.queryResetTimer=setTimeout(()=>this.query="",1e3)}}findComponent(n,t){for(const i of n.states)for(const n of i.containers)for(const i of n.components)if(i.id===t)return i}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetApiSettings=(class{constructor(){this.displaySingleOverlay=!1}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.GroupedWidgets=(class{constructor(n,t){this.campaignId=n;this.widgets=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i{constructor(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){this.logger=t;this.mtr=i;this.windowProvider=r;this.visitorStateService=u;this.widgetPreviewService=f;this.widgetsCloseService=e;this.widgetDisplaySettingsService=o;this.widgetService=s;this.trackerService=h;this.widgetEventsService=c;this.widgetUtilities=l;this.discountCodeService=a;this.httpClient=v;this.formsService=y;this.abTestingCampaignService=p;this.widgetStatesService=w;this.scoresService=b;this.openedCampaigns=[];this.campaignsOpenedOnCurrentPageview=[];this.window=r.get();this.settings=this.window.triggerbee.widgets.settings||new n.WidgetApiSettings}init(){let n=this;!function(){t(this,void 0,void 0,function*(){yield n.initInternal()})}()}initAsync(){return t(this,void 0,void 0,function*(){this.mtr.isTrackerInitialized()?(this.logger.debug("Started initializing widgets"),yield this.initInternal()):document.addEventListener&&document.addEventListener("afterTriggerbeeReady",()=>t(this,void 0,void 0,function*(){this.logger.debug("Tracker initialized event triggered. Started initializing widgets");yield this.initInternal()}))})}initInternal(){return t(this,void 0,void 0,function*(){if(!this.mtr.getUid())return void this.logger.warn("No uid found on init, cookie probably deleted or not allowed to be set");this.widgetEventsService.triggerEvent("onTriggerbeeWidgetsIsInitializing",void 0);this.widgetsCloseService.removeExpiredWidgets();this.openedCampaigns=[];this.campaignsOpenedOnCurrentPageview=[];const n=this.widgetPreviewService.getWidgetSharingData();if(n&&n.campaignId){const t=this.widgetUtilities.getConfiguredWidgets().filter(t=>t.campaignId===n.campaignId);t.length>0&&(this.visitorStateService.increasePageViews(),yield this.openWidgetsInternal(t,!0))}else if(n&&n.widgetId){const i=this.widgetUtilities.getWidgetbyId(+n.widgetId);if(i){if(n.triggerType){const t=i.triggers.find(t=>t.type==n.triggerType);t&&(i.triggers=[t])}this.widgetDisplaySettingsService.configureWidgetOpeners([i]);const r=this.widgetDisplaySettingsService.getWidgetOpeners(i);for(let n of r)yield n.onBeforeOpenAsync(()=>t(this,void 0,void 0,function*(){this.widgetService.isWidgetWithCurrentCampaignAlreadyOpen(i)||(yield this.widgetService.openWidget(i))}))}}else if(this.widgetPreviewService.isPreview()){const i=+this.widgetPreviewService.getWidgetPreviewParameterValue();let r=this.widgetUtilities.getWidgetJsonUrl(i,!0);const t=(yield this.httpClient.getAsync(r)).data,n=t;n.id=t.widgetId;this.logger.debug(`Previewing widget '${n.id}'`);this.widgetUtilities.configureWidgets([n]);this.widgetService.isWidgetWithCurrentCampaignAlreadyOpen(n)||(yield this.widgetService.openWidget(n))}else{const n=this.widgetUtilities.getConfiguredWidgets();n.length>0&&(this.visitorStateService.increasePageViews(),yield this.openWidgetsInternal(n))}this.logger.debug("Done initializing widgets");this.widgetEventsService.triggerEvent("onTriggerbeeWidgetsInitialized",void 0)})}groupWidgetsByCampaignId(t){let i=[],r=n.ArrayHelper.groupBy(t,"campaignId");if(this.settings.displaySingleOverlay){const t=Object.entries(r).sort((n,t)=>t[0].localeCompare(n[0]));for(let r in t){const u=t[r];i.push(new n.GroupedWidgets(u[0],u[1]))}}else for(let t in r)i.push(new n.GroupedWidgets(t,r[t]));return i}openWidgetsInternal(i,r=!1){return t(this,void 0,void 0,function*(){for(let u of this.groupWidgetsByCampaignId(i)){const f=u.campaignId,i=u.widgets.sort((n,t)=>n.order>t.order?1:n.order<t.order?-1:0);this.widgetDisplaySettingsService.configureWidgetOpeners(i);for(let u of i){if(this.widgetService.isWidgetWithCurrentCampaignAlreadyOpen(u))break;if(this.widgetDisplaySettingsService.checkUrlSettings(u)){const e=this.widgetDisplaySettingsService.getWidgetOpeners(u);if(!(e.length<1))for(let o of e)if(r&&o instanceof n.ManualWidgetOpener){let n=yield this.widgetService.shouldOpenWidget(u);if(this.logger.info(`Trying to open widget ${u.id} manually. ShouldOpenWidget: ${n}`),n){yield this.openWidgetByCampaignType(f,u,i);break}}else if(o instanceof n.DefaultWidgetOpener){let n=yield this.widgetService.shouldOpenWidget(u);if(this.logger.info(`Trying to open widget ${u.id}. ShouldOpenWidget: ${n}`),n){yield this.openWidgetByCampaignType(f,u,i);break}}else o.trigger&&this.logger.debug(`Widget '${u.id}' will be opened. Trigger: '${o.trigger.type}'. Value: '${o.trigger.value}'`),yield o.onBeforeOpenAsync(()=>t(this,void 0,void 0,function*(){let n=yield this.widgetService.shouldOpenWidget(u);this.logger.info(`Trying to open widget ${u.id} by callback. ShouldOpenWidget: ${n}`);n&&(yield this.openWidgetByCampaignType(f,u,i))}))}}}})}openWidgetByCampaignType(i,r,u){return t(this,void 0,void 0,function*(){if(this.settings.displaySingleOverlay&&this.widgetService.isAnyOverlayAlreadyOpened(r,this.widgetUtilities.getConfiguredWidgets(),this.campaignsOpenedOnCurrentPageview))return void this.logger.info(`Display single overlay is activated and another overlay is already opened this pageview. Widget '${r.id}' will therefore not be shown`);if(this.openedCampaigns.indexOf(r.campaignId)>-1)this.logger.debug("Campaign "+r.campaignId+" is already opened");else{switch(this.openedCampaigns.push(+r.campaignId),this.campaignsOpenedOnCurrentPageview.push(r.campaignId),r.campaignType){case n.CampaignType.Regular:case n.CampaignType.Survey:break;case n.CampaignType.ABTesting:r=this.abTestingCampaignService.getWidgetToShow(i,u);break;default:this.logger.debug("Unknown type of campaign!")}yield this.widgetService.openWidget(r)}})}open(n){return t(this,void 0,void 0,function*(){const t=this.widgetUtilities.getWidgetbyId(n);t&&(this.logger.info(`Opening widget ${n}`),yield this.widgetService.openWidget(t))})}trigger(n){return t(this,void 0,void 0,function*(){this.logger.info(`Trying to open campaign ${n} manually`);const t=this.widgetUtilities.getConfiguredWidgets().filter(t=>t.campaignId==n);this.openWidgetsInternal(t,!0)})}close(i){return t(this,void 0,void 0,function*(){this.widgetsCloseService.markAsClosed(i,n.RepetitionType.Dismissal);this.widgetDisplaySettingsService.removeRegisteredEventWidgetOpeners(i);const t=this.widgetUtilities.getWidgetbyId(i).campaignId;(yield this.widgetService.closeWidget(i))&&this.trackerService.logWidgetClosed(i,t);this.openedCampaigns=this.openedCampaigns.filter(function(n){return n!=t})})}redirect(t,i){this.openUrlInternal(t,i,()=>{this.widgetsCloseService.markAsClosed(t,n.RepetitionType.ClickThrough),window.location=i})}openInNewTab(t,i){this.openUrlInternal(t,i,()=>{this.widgetsCloseService.markAsClosed(t,n.RepetitionType.ClickThrough),this.widgetService.closeWidget(t),window.open(i,"_blank")})}openUrlInternal(n,t,i){let u=this;const r=this.widgetUtilities.getWidgetbyId(n);this.widgetEventsService.triggerOnButtonClick(r,t);this.trackerService.logGoal(`oc_click_${n}`,function(){u.trackerService.logClickThrough(n,r.campaignId,function(){i()})})}openInNewTabAndSwitchState(n,t,i){var r=this;this.openUrlInternal(n,t,function(){window.open(t,"_blank");r.widgetStatesService.switchState(n,i)})}submit(i,r,u,f,e){var o,h;i.preventDefault();o=this.widgetUtilities.getWidgetbyId(u);let s=r.querySelector(".component-buttonsubmit button");s||(s={},this.logger.error(`Could not find submit button by CSS class for widget ${u}`));const c=JSON.parse(JSON.stringify(s));s=this.widgetUtilities.getSpinner(s);s.disabled=!0;try{this.widgetEventsService.triggerOnBeforeFormSubmission(o);const s=this.formsService.getFormData(r);o.responseListId&&(s.responseListId=o.responseListId,s.submitPath=this.window.location.pathname);const c=s.email;this.logger.debug(`Submitting form in widget '${o.id}' - custom data: ${JSON.stringify(s)}`);this.trackerService.setCustomData(s);let i=this;const l=function(){const h=o.campaignType===n.CampaignType.Survey?"survey-response":"conversion";i.trackerService.logSubmit(h,u,o.campaignId,function(){return t(this,void 0,void 0,function*(){if(i.widgetsCloseService.markAsClosed(u,n.RepetitionType.Conversion),f!=n.WidgetComponentButtonAction.SwitchState&&i.widgetService.closeWidget(u),i.formsService.logConsent(o,r,s),f==n.WidgetComponentButtonAction.SwitchState){let n=+e;!i.widgetPreviewService.isPreview()&&o.subscriberCheckStateId&&(yield i.formsService.checkIsSubscriber(c,o.id)?n=o.subscriberCheckStateId:window.triggerbee.session.addTags("NewSubscriber"));i.widgetStatesService.switchState(u,n)}i.widgetEventsService.triggerOnAfterFormSubmission(o)})})};h=this.scoresService.setScore(h,s,o);this.trackerService.logEvent({name:`oc_submit_${u}`,type:"goal",id:o.id,data:h,callback:l})}catch(n){throw s=c,s.disabled=!1,this.logger.error(`Widget '${o.id}': Could not submit form. We let the visitor try to submit again.`),n;}}openConsentPolicy(){const n=window.mtr_consent;void 0===n?this.logger.error("Could not open policy - Triggerbee Consent is not initialized"):n.open("policy")}switchState(n,t,i){let r=i&&i.classList.contains("button-hide");if(this.widgetStatesService.isCurrentStateFormValid(i)||r){const u=this.widgetStatesService.getCurrentStateElement(n,i),f=this.formsService.isConsentElementVisible(u);this.widgetStatesService.switchState(n,t);r||this.formsService.partialSubmit(n,f,u)}}switchStateNext(n,t){const i=this.widgetStatesService.getCurrentStateElement(t,n),r=this.formsService.isConsentElementVisible(i);this.widgetStatesService.validateAndSwitchStateNext(n,t)&&this.formsService.partialSubmit(t,r,i)}switchStatePrevious(n,t){this.widgetStatesService.switchStatePrevious(n,t)}minimizeWidget(n,t){this.widgetStatesService.switchStateTemplateMethod(n,t,n=>{this.widgetEventsService.triggerOnWidgetMinimized(n,t)})}copyDiscountCode(n){this.discountCodeService.copyDiscountCode(n)}reset(){this.widgetService.getAllOpenWidgets().forEach(n=>n.remove());this.widgetDisplaySettingsService.registeredEventWidgetOpeners&&this.widgetDisplaySettingsService.registeredEventWidgetOpeners.forEach(n=>{n.reset()})}share(n,t,i,r,u,f){const e=this.getShareUrl(r,f);if(this.window.navigator.share){const n={text:i,url:e};this.window.navigator.share(n)}else{const i=this.widgetUtilities.getWidgetElementById(n).shadowRoot.querySelector(`[data-component="${u}"]`);let t;void 0!==t&&clearTimeout(t);t=this.widgetUtilities.copyText(i.querySelector(".copied-text-wrapper"),i.querySelector(".copy-text"))}this.trackerService.logWidgetShare(n,t)}getShareUrl(n,t){return this.window.location.origin+(t?this.window.location.pathname:"")+n}static getDefault(){const k=new n.DateProvider,r=new n.WindowProvider,d=new n.CookieProvider,f=new n.Utilities(r,d);f.setDebugCookie();const t=f.isDebugMode()?new n.ConsoleLogger:new n.EmptyLogger,u=new n.WidgetUtilities(t,r),e=new n.Tracker(t,r),o=new n.VisitorStateService(t,f,u),s=new n.WidgetPreviewService,a=new n.WidgetsCloseService(t,f,s,o,u),g=new n.DocumentProvider,nt=new n.ExitIntentTracker(r,g),c=new n.TrackerService(t,e,s),tt=new n.RepetitionCheckService(t,a,c,o),w=new n.WidgetConditionsService(t,f,r),it=new n.WidgetSchedulingService(t,k),h=new n.HttpClient(u,e),l=new n.FormsService(t,h,r,c,u,o,f),rt=new n.AudienceChecker(t,h,r,e,o,w,u),v=new n.WidgetEventsService(t,f),ut=new n.SplitInputsToStepsService(t,l),ft=new n.ProductRecommendationsService(h,r,e,u,s),b=new n.WidgetContainersService(f),y=new n.DiscountCodeService(t,c,f,u,o,h,r,e,s),p=new n.WidgetService(t,r,a,w,tt,it,rt,v,u,ft,e,c,h,y,new n.DeadlineComponentService,new n.ButtonListComponentService(t),b,ut,o,s,l,new n.WidgetComponentsService(t)),et=new n.WidgetDisplaySettingsService(t,o,nt,p,r),ot=new n.ScoresService(e);return new i(t,e,r,o,s,a,et,p,c,v,u,y,h,l,new n.AbTestingCampaignService(e),new n.WidgetStatesService(t,p,u,s,v,o,l,b,y),ot)}}n.WidgetApi=i}(n.Widgets||(n.Widgets={}))}(n||(n={}));r(),function(n){!function(n){n.WidgetSharingData=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.AudienceCheckRequest=(class{constructor(n,t){this.uid=n;this.siteId=t}});n.AudienceClientDataRequest=(class{constructor(n,t){n&&(this.landingPageQueryParams=n.landingPageQueryParams,this.npsScore=n.npsScore,this.csatScore=n.csatScore);t&&(this.goals=t.goals,this.identityTags=t.tags,this.identifier=t.identifier,this.consentVersions=t.consentVersions)}});n.AudienceCheckResponse=(class{});n.AudienceCheckCacheEntry=(class{constructor(n,t,i){this.audienceId=n;this.siteId=t;this.result=i}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.BrowserLanguageHelper=(class{static getBrowserLanguage(){if(window&&window.navigator&&window.navigator.language){const n=window.navigator.language;if(n)return n}if(navigator&&navigator.language){const n=navigator.language;if(n)return n}if(navigator&&navigator.userLanguage){const n=navigator.userLanguage;if(n)return n}if(window&&window.navigator&&window.navigator.browserLanguage){const n=window.navigator.browserLanguage;if(n)return n}if(window&&window.navigator&&window.navigator.languages&&window.navigator.languages.length>0){const n=window.navigator.languages[0];if(n)return n}}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t{constructor(n,t){this.language=n;this.code=t}}class i{static getCode(n){let t,i=this.map.find(t=>t.language==n);return i&&(t=i.code),t}}i.map=[new t("Mandarin Chinese","zh"),new t("English","en"),new t("Hindustani","hi"),new t("Spanish","es"),new t("Arabic","ar"),new t("Malay","ms"),new t("Russian","ru"),new t("Bengali","bn"),new t("Swedish","sv"),new t("Norwegian","no"),new t("Finnish","fi"),new t("German","de"),new t("French","fr"),new t("Dutch","nl"),new t("Danish","da"),new t("Italian","it"),new t("Polish","pl"),new t("Portuguese","pt")];n.LanguageCodeHelper=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.WidgetClosed=(class{constructor(n,t,i){this.id=n;this.reason=t;this.pageviews=i;this.closedTime=(new Date).valueOf()}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.VisitorState=(class{});n.VisitorStateWidget=(class{});n.usedSingleCoupons=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t{constructor(n){this.variantName=n.variantName;this.id=n.id;this.campaignName=n.campaignName;this.campaignId=n.campaignId;this.tags=n.tags}}n.WidgetEvent=t;n.WidgetSwitchStateEvent=(class extends t{constructor(n,t){super(n);this.stateId=t}});n.WidgetButtonClickEvent=(class extends t{constructor(n,t){super(n);this.url=t}});n.WidgetMinimizedEvent=(class extends t{constructor(n,t){super(n);this.stateId=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.RepetitionCheckerBase=(class{constructor(n,t){this.widget=n;this.widgetCloseService=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.RepetitionCheckerBase{shouldShowNow(){return this.widgetCloseService.cancelClosing(this.widget.id),!0}}n.ContinueShowingChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){class i extends t.RepetitionCheckerBase{constructor(n,t,i,r){super(n,i);this.repetition=t;this.trackerService=r}shouldShowNow(){let r=this.widgetCloseService.getClosedWidgetData(this.widget.id),t=((new Date).valueOf()-r.closedTime)/1e3,i=60*this.repetition.value;if(t>=i)return this.widgetCloseService.cancelClosing(this.widget.id),!0;let n=1e3*(i-t);return n>2147483647&&(n=2147483647),setTimeout(()=>{this.widgetCloseService.cancelClosing(this.widget.id),this.trackerService.logWidgetOpened(this.widget.id,this.widget.campaignId),this.openWidget()},n),!1}openWidget(){let t=document.createElement(n.Widgets.WebComponents.TriggerbeeWidgetElement.selector);t.setAttribute("data-id",this.widget.id.toString());document.body.appendChild(t)}}t.DisableShowingForXMinutesChecker=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.RepetitionCheckerBase{constructor(n,t,i,r){super(n,i);this.repetition=t;this.visitorStateService=r}shouldShowNow(){let n=this.widgetCloseService.getClosedWidgetData(this.widget.id);if(n){let t=n.pageviews;if(this.visitorStateService.getCurrentState().pageviews-t>this.repetition.value)return this.widgetCloseService.cancelClosing(this.widget.id),!0}return!1}}n.DisableShowingForXPageviewsChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.DoNotShowAgainChecker=(class{shouldShowNow(){return!1}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{onBeforeOpenAsync(n){return t(this,void 0,void 0,function*(){const i=1e3*this.trigger.value;this.timer=setTimeout(()=>t(this,void 0,void 0,function*(){yield n()}),i)})}reset(){return t(this,void 0,void 0,function*(){this.timer&&(clearTimeout(this.timer),this.timer=null)})}}n.DelayedBySecondsWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{constructor(n,t,i){super(n,i);this.widgetService=t;this.mousemoveEventName="mousemove";this.keyPressEventName="keypress";this.registeredEvents=[];this.timeout=this.trigger.value?this.trigger.value:60}onBeforeOpenAsync(i){return t(this,void 0,void 0,function*(){this.resetTimer(i);const r=this,u=function(){return t(this,void 0,void 0,function*(){r.resetTimer(i)})};document.addEventListener(this.mousemoveEventName,u);this.registeredEvents.push(new n.RegisteredEvent(this.mousemoveEventName,u));const f=function(){return t(this,void 0,void 0,function*(){r.resetTimer(i)})};document.addEventListener(this.keyPressEventName,f);this.registeredEvents.push(new n.RegisteredEvent(this.keyPressEventName,f))})}resetTimer(n){clearTimeout(this.timer);let i=this;this.timer=setTimeout(()=>t(this,void 0,void 0,function*(){(yield i.widgetService.shouldOpenWidget(i.widget))&&(yield n())}),1e3*this.timeout)}reset(){return t(this,void 0,void 0,function*(){if(this.registeredEvents.length>0)for(var n=0;n<this.registeredEvents.length;n++){const t=this.registeredEvents[n];document.removeEventListener(t.name,t.eventListener);this.registeredEvents.splice(n,1)}this.timer&&(clearTimeout(this.timer),this.timer=null)})}}n.InactiveForXSecondsOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{constructor(n,t){super(n,t)}onBeforeOpenAsync(){return t(this,void 0,void 0,function*(){})}}n.ManualWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{constructor(n,t,i){super(n,t);this.exitIntentTracker=i}onBeforeOpenAsync(i){return t(this,void 0,void 0,function*(){if(this.exitIntentOptions)this.exitIntentTracker.enable(),this.exitIntentTracker.addOnBounce(function(){return t(this,void 0,void 0,function*(){yield i()})});else{let r=new n.ExitIntentTrackerOptions;r.aggressive=!0;r.sensitivity=1;this.exitIntentTracker.enable();this.exitIntentTracker.init(r);this.exitIntentTracker.addOnBounce(function(){return t(this,void 0,void 0,function*(){yield i()})});this.exitIntentOptions=r}})}reset(){return t(this,void 0,void 0,function*(){this.exitIntentTracker.disable()})}}n.OnExitIntentWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{constructor(){super(...arguments);this.eventName="scroll";this.registeredEvents=[]}onBeforeOpenAsync(i){return t(this,void 0,void 0,function*(){let u=this.trigger.value,r=!1;if(document.documentElement.scrollHeight>window.innerHeight){const f=function(){return t(this,void 0,void 0,function*(){let n=document.documentElement,t=document.body;Math.round((n.scrollTop||t.scrollTop)/((n.scrollHeight||t.scrollHeight)-n.clientHeight)*100)>=u&&!r&&(r=!0,yield i())})};this.registeredEvents.push(new n.RegisteredEvent(this.eventName,f));document.addEventListener(this.eventName,f)}else yield i()})}reset(){return t(this,void 0,void 0,function*(){if(this.registeredEvents.length>0)for(var n=0;n<this.registeredEvents.length;n++){const t=this.registeredEvents[n];document.removeEventListener(t.name,t.eventListener);this.registeredEvents.splice(n,1)}})}}n.OnScrollWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class i extends n.WidgetOpenerBase{constructor(n,t,i,r){super(i,r);this.logger=n;this.visitorStateService=t}onBeforeOpenAsync(n){return t(this,void 0,void 0,function*(){let t=this.visitorStateService.getCurrentState();this.checkPageviews(this.widget,t,this.trigger)&&(yield n())})}checkPageviews(n,t,i){return t.pageviews>i.value||(this.logger.debug(`Widget '${n.id}': Pageviews trigger not completed. Expected: ${i.value}. Actual: ${t.pageviews}`),!1)}}n.PageviewsWidgetOpener=i}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.BrowserLanguageConditionChecker=(class{constructor(n){this.condition=n}canBeOpened(){const i=n.BrowserLanguageHelper.getBrowserLanguage(),r=this.condition.value.split(",");let t=!1;return r.forEach(r=>{if(r){let u=n.LanguageCodeHelper.getCode(r);if(u){let r=i.startsWith(u);this.condition.operator==n.WidgetConditionOperator.NotEquals&&(r=!r);t=t||r}}}),this.condition.show?t:!t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.CampaignEventsCheckerBase=(class{getSettings(n){return n?JSON.parse(n):{}}filterEvents(n,t,i){return n.campaignEvents.filter(n=>n.type===t&&n.campaignId===i)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.CampaignEventsCheckerBase{constructor(n,t,i){super();this.logger=n;this.condition=t;this.person=i}canBeOpened(){const t=this.getSettings(this.condition.value),r=+t.campaignId,u=+t.times;let i=0;return this.person.campaignEvents&&(i=this.filterEvents(this.person,"clickthrough",r).length),!!n.ConditionsHelper.CompareWithOperator(u,i,this.condition.operator)}}n.CampaignClickthroughConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.CampaignEventsCheckerBase{constructor(n,t,i){super();this.logger=n;this.condition=t;this.person=i}canBeOpened(){const t=this.getSettings(this.condition.value),r=+t.campaignId,u=+t.times;let i=0;return this.person.campaignEvents&&(i=this.filterEvents(this.person,"conversion",r).length),!!n.ConditionsHelper.CompareWithOperator(u,i,this.condition.operator)}}n.CampaignConversionConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.CampaignEventsCheckerBase{constructor(n,t,i){super();this.logger=n;this.condition=t;this.person=i}canBeOpened(){const t=this.getSettings(this.condition.value),r=+t.campaignId,u=+t.times;let i=0;return this.person.campaignEvents&&(i=this.filterEvents(this.person,"dismissal",r).length),!!n.ConditionsHelper.CompareWithOperator(u,i,this.condition.operator)}}n.CampaignDismissalConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.CampaignEventsCheckerBase{constructor(n,t,i){super();this.logger=n;this.condition=t;this.person=i}canBeOpened(){const t=this.getSettings(this.condition.value),r=+t.campaignId,u=+t.times;let i=0;return this.person.campaignEvents&&(i=this.filterEvents(this.person,"open",r).length),!!n.ConditionsHelper.CompareWithOperator(u,i,this.condition.operator)}}n.CampaignOpenedConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.ConditionsHelper=(class{static CompareWithOperator(t,i,r){switch(r){case n.Widgets.WidgetConditionOperator.StartsWith:return t.startsWith(i);case n.Widgets.WidgetConditionOperator.EndsWith:return t.endsWith(i);case n.Widgets.WidgetConditionOperator.Contains:return t.includes(i);case n.Widgets.WidgetConditionOperator.AnyOf:return i.split(",").some(n=>n==t);case n.Widgets.WidgetConditionOperator.NotEquals:return t!=i;case n.Widgets.WidgetConditionOperator.MoreThan:return t<i;case n.Widgets.WidgetConditionOperator.LessThan:return t>i;default:return t==i}}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.PlatformConditionCheckerBase=(class{constructor(n){this.utilities=n}isMobile(){return this.utilities.isMobile()}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.DomainConditionChecker=(class{constructor(n,t){this.condition=n;this.windowProvider=t}canBeOpened(){switch(this.condition.operator){case n.WidgetConditionOperator.Equals:return this.windowProvider.get().location.hostname===this.condition.value;case n.WidgetConditionOperator.NotEquals:return this.windowProvider.get().location.hostname!==this.condition.value;default:return!1}}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(t){t.RefererConditionCheckerBase=(class{constructor(){this.fbDomains=["facebook."];this.igDomains=["instagram."];this.otherSocialNetworks=["pinterest.","t.co","reddit","lnkd.in","linkedin."]}checkRefererDomain(t){const i=document.referrer;switch(t){case n.Widgets.SocialMediaType.Facebook:return this.contains(this.fbDomains,i);case n.Widgets.SocialMediaType.Instagram:return this.contains(this.igDomains,i);default:return this.contains(this.fbDomains,i)||this.contains(this.igDomains,i)||this.contains(this.otherSocialNetworks,i)}}contains(n,t){return n.some(n=>t.indexOf(n)>-1)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.RefererConditionCheckerBase{constructor(n){super();this.condition=n}canBeOpened(){let t=this.checkRefererDomain(n.SocialMediaType.Facebook);return this.condition.show?t:!t}}n.FacebookVisitConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.RefererConditionCheckerBase{constructor(n){super();this.condition=n}canBeOpened(){let t=this.checkRefererDomain(n.SocialMediaType.Instagram);return this.condition.show?t:!t}}n.InstagramVisitConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.JsExpressionChecker=(class{constructor(n,t,i){this.logger=n;this.widgetId=t;this.condition=i}canBeOpened(){if(this.condition.value){const n=new Function("expression","return eval(expression);");try{let t=!!n(this.condition.value);return this.condition.show?t:!t}catch(n){this.logger.warn(`Widget '${this.widgetId}': Error parsing expression: ${this.condition.value}`)}}return!1}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.QueryParameterConditionCheckerBase=(class{constructor(n){this.windowProvider=n;this.query=new URLSearchParams(this.windowProvider.get().location.search)}hasParamValue(t,i,r){if(this.query.has(t)){let u=this.query.get(t);return n.ConditionsHelper.CompareWithOperator(u,i,r)}return r===n.WidgetConditionOperator.NotEquals}hasParameter(n){return this.query.has(n)}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.QueryParameterConditionCheckerBase{constructor(n,t){super(t);this.condition=n;this.windowLocal=t.get()}getMarketingEmailParams(){const n=this.windowLocal.triggerbee.widgets.emailProviderQueryStrings;return["utm_medium=email"].concat(n)}canBeOpened(){let t=!1;return this.getMarketingEmailParams().forEach(i=>{let r=i.split("="),u=r[0],f=r[1];t=f?t||this.hasParamValue(u,f,n.WidgetConditionOperator.Equals):t||this.hasParameter(u)}),this.condition.show?t:!t}}n.MarketingEmailConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.NewVisitorConditionChecker=(class{constructor(n,t,i){this.logger=n;this.condition=t;this.person=i}canBeOpened(){const n=this.person;let t=!0;return n&&n.visits&&n.visits.length>1&&(t=!1),t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.PlatformConditionCheckerBase{canBeOpened(){return!this.isMobile()}}n.OnlyDesktopConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.PlatformConditionCheckerBase{canBeOpened(){return this.isMobile()}}n.OnlyMobileConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.QueryParameterConditionCheckerBase{constructor(n,t){super(t);this.condition=n}canBeOpened(){if(!this.condition.value)return!1;this.condition.value.startsWith("?")&&(this.condition.value=this.condition.value.substr(1));let n=!0;if(-1!=this.condition.value.indexOf("&")){let t=this.condition.value.split("&");t&&t.forEach(t=>{n=n&&this.getResult(t,this.condition.operator)})}else n=this.getResult(this.condition.value,this.condition.operator);return this.condition.show?n:!n}getResult(n,t){if(n){let i=n.split("=");if(i){let n=i[0],r=i[1];return r?this.hasParamValue(n,r,t):this.hasParameter(n)}}return!1}}n.QueryParameterConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.ReturningVisitorConditionChecker=(class{constructor(n,t,i){this.logger=n;this.condition=t;this.person=i}canBeOpened(){const n=this.person,t=+this.condition.value;return n&&n.visits&&n.visits.length>t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.RefererConditionCheckerBase{constructor(n){super();this.condition=n}canBeOpened(){let t=this.checkRefererDomain(n.SocialMediaType.Any);return this.condition.show?t:!t}}n.SocialMediaVisitConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.UsersCookieConditionChecker=(class{constructor(n,t){this.condition=n;this.utils=t}canBeOpened(){if(this.condition.value){let t=this.getCookieParts(this.condition.value);if(t.isComplete){if(t.cookieKeyValuePair.length>1){let i,u=t.cookieKeyValuePair[0],f=t.cookieKeyValuePair[1],r=u.split(".");if(r.length>1){let t=r.splice(0,1)[0],n=this.utils.getCookie(t);if(n){let t=JSON.parse(n);if(t){let n=r.splice(0,1)[0];i=t[n];r.forEach(n=>{i=i[n]})}}}else i=this.utils.getCookie(u);if(f){let r=n.ConditionsHelper.CompareWithOperator(i,f,t.operator),u=t.isDenial?!r:r;return this.condition.show?u:!u}}}else if(this.utils.getCookie(this.condition.value))return this.condition.show}return!1}getCookieParts(t){let i,r,u=!1,f=!0;return t.startsWith(n.CookieOperator.NotOperator)?(u=!0,t=t.substr(n.CookieOperator.NotOperator.length)):t.startsWith(n.CookieOperator.Not)&&(u=!0,t=t.substr(n.CookieOperator.Not.length)),t.indexOf(n.CookieOperator.AnyOf)>-1?(i=t.split(n.CookieOperator.AnyOf),i[1]=this.sanitizeCookieValue(i[1]),r=n.WidgetConditionOperator.AnyOf):t.indexOf(n.CookieOperator.Contains)>-1?(i=t.split(n.CookieOperator.Contains),i[1]=this.sanitizeCookieValue(i[1]),r=n.WidgetConditionOperator.Contains):t.indexOf(n.CookieOperator.EndsWith)>-1?(i=t.split(n.CookieOperator.EndsWith),i[1]=this.sanitizeCookieValue(i[1]),r=n.WidgetConditionOperator.EndsWith):t.indexOf(n.CookieOperator.StartsWith)>-1?(i=t.split(n.CookieOperator.StartsWith),i[1]=this.sanitizeCookieValue(i[1]),r=n.WidgetConditionOperator.StartsWith):t.indexOf(n.CookieOperator.NotEqualsOperator)>-1?(i=t.split(n.CookieOperator.NotEqualsOperator),r=n.WidgetConditionOperator.NotEquals):t.indexOf(n.CookieOperator.EqualsOperator)>-1?(i=t.split(n.CookieOperator.EqualsOperator),r=n.WidgetConditionOperator.Equals):f=!1,new n.CookieRequestParseResult(i,r,u,f)}sanitizeCookieValue(n){return((n=n.slice(1,-1)).startsWith('"')||n.startsWith("'"))&&(n=n.substr(1)),(n.endsWith('"')||n.endsWith("'"))&&(n=n.slice(0,-1)),n}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.QueryParameterConditionCheckerBase{constructor(n,t,i){super(i);this.condition=n;this.visit=t}canBeOpened(){const r="utm_campaign";let t=this.hasParamValue(r,this.condition.value,this.condition.operator);var i=this.visit.landingPageQueryParams.find(n=>n.startsWith(r+"="));if(void 0!==i){const r=decodeURIComponent(i.substring(i.indexOf("=")+1));t=n.ConditionsHelper.CompareWithOperator(r,this.condition.value,this.condition.operator)}return this.condition.show?t:!t}}n.UTMCampaignConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.QueryParameterConditionCheckerBase{constructor(n,t,i){super(i);this.condition=n;this.visit=t}canBeOpened(){const r="utm_medium";let t=this.hasParamValue(r,this.condition.value,this.condition.operator);var i=this.visit.landingPageQueryParams.find(n=>n.startsWith(r+"="));if(void 0!==i){const r=i.substring(i.indexOf("=")+1);t=n.ConditionsHelper.CompareWithOperator(r,this.condition.value,this.condition.operator)}return this.condition.show?t:!t}}n.UTMMediumConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){class t extends n.QueryParameterConditionCheckerBase{constructor(n,t,i){super(i);this.condition=n;this.visit=t}canBeOpened(){const r="utm_source";let t=this.hasParamValue(r,this.condition.value,this.condition.operator);var i=this.visit.landingPageQueryParams.find(n=>n.startsWith(r+"="));if(void 0!==i){const r=i.substring(i.indexOf("=")+1);t=n.ConditionsHelper.CompareWithOperator(r,this.condition.value,this.condition.operator)}return this.condition.show?t:!t}}n.UTMSourceConditionChecker=t}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.SlidingFormConfig=(class{});let t;n.SlidingFormStep=(class{}),function(n){n.Component="Component";n.ComponentGroup="ComponentGroup"}(t=n.SlidingFormStepType||(n.SlidingFormStepType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Condition=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.Equals="Equals";n.StartsWith="StartsWith";n.EndsWith="EndsWith";n.Contains="Contains";n.AnyOf="AnyOf";n.NotEquals="NotEquals";n.MoreThan="MoreThan";n.LessThan="LessThan"}(t=n.WidgetConditionOperator||(n.WidgetConditionOperator={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.QueryParam="QueryParam";n.UTMCampaign="UTMCampaign";n.UTMSource="UTMSource";n.UTMMedium="UTMMedium";n.BrowserLanguage="BrowserLanguage";n.FacebookVisit="FacebookVisit";n.InstagramVisit="InstagramVisit";n.OtherSocialMediaVisit="OtherSocialMediaVisit";n.MarketingEmailVisit="MarketingEmailVisit";n.JsExpression="JsExpression";n.CookieExists="CookieExists";n.CookieEquals="CookieEquals";n.OnlyMobile="OnlyMobile";n.OnlyDesktop="OnlyDesktop";n.Domain="Domain";n.NewVisitor="NewVisitor";n.ReturningVisitor="ReturningVisitor";n.CampaignOpened="CampaignOpened";n.CampaignDismissal="CampaignDismissal";n.CampaignConversion="CampaignConversion";n.CampaignClickthrough="CampaignClickthrough";n.CampaignSurveyResponse="CampaignSurveyResponse"}(t=n.WidgetConditionType||(n.WidgetConditionType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.ContinueShowing="ContinueShowing";n.DisableShowingForXMinutes="DisableShowingForXMinutes";n.DontShowAgain="DontShowAgain";n.DisableShowingForXPageViews="DisableShowingForXPageViews"}(t=n.RepetitionOption||(n.RepetitionOption={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Repetition=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Scheduling=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.Instantly="Instantly";n.AfterXPageviews="AfterXPageviews";n.AfterXSeconds="AfterXSeconds";n.ExitIntent="ExitIntent";n.Scroll="Scroll";n.InactiveForXSeconds="InactiveForXSeconds";n.Manual="Manual"}(t=n.WidgetTriggerType||(n.WidgetTriggerType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.Trigger=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.UrlSettings=(class{})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.RegisteredEvent=(class{constructor(n,t){this.name=n;this.eventListener=t}})}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n[n.Facebook=0]="Facebook";n[n.Instagram=1]="Instagram";n[n.Any=2]="Any"}(t=n.SocialMediaType||(n.SocialMediaType={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){let t;!function(n){n.EqualsOperator="=";n.NotEqualsOperator="!=";n.StartsWith=".startsWith";n.EndsWith=".endsWith";n.Contains=".contains";n.AnyOf=".anyOf";n.NotOperator="!";n.Not="not "}(t=n.CookieOperator||(n.CookieOperator={}))}(n.Widgets||(n.Widgets={}))}(n||(n={})),function(n){!function(n){n.CookieRequestParseResult=(class{constructor(n,t,i,r){this.cookieKeyValuePair=n;this.operator=t;this.isDenial=i;this.isComplete=r}})}(n.Widgets||(n.Widgets={}))}(n||(n={}));await window.triggerbee.widgets.api.initAsync()})();